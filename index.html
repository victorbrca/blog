<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Victor&#39;s Blog </title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">


<meta property="og:title" content="Victor&#39;s Blog ">
<meta property="og:site_name" content="Victor&#39;s Blog"/>
<meta property="og:url" content="https://blog.victormendonca.com/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="website" />



<link href="https://blog.victormendonca.com/index.xml" rel="alternate" type="application/rss+xml" title="Victor&#39;s Blog" />

<link rel="canonical" href="https://blog.victormendonca.com/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.victormendonca.com/touch-icon-144-precomposed.png">
<link rel="icon" href="https://blog.victormendonca.com/favicon.png">
<meta name="generator" content="Hugo 0.48" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="https://blog.victormendonca.com/css/bootswatch/default/bootstrap.min.css">


<link rel="stylesheet" href="https://blog.victormendonca.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://blog.victormendonca.com/css/style.css">


<link rel="stylesheet" href="https://blog.victormendonca.com/css/style_custom.css">



  <link rel="stylesheet" href="https://blog.victormendonca.com/css/highlight/github.css">


</head>
<body class="map[name:default]" data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="https://blog.victormendonca.com/">
          Victor&#39;s Blog
          
          
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">

              <a href="https://blog.victormendonca.com/" >
                
                Home
              </a>
            </li>
            
            <li class="">

              <a href="https://blog.victormendonca.com/about/" >
                
                About
              </a>
            </li>
            
            <li class="">

              <a href="https://geekit.ca/" >
                
                Professional
              </a>
            </li>
            
            <li class="">

              <a href="https://manhattan.victormendonca.com/" >
                
                Manhattan Blog
              </a>
            </li>
            
            
            
          </ul>
        </div>
        
      </div>
    </nav>
  </header>


  <div class="container">
    
    <div class="row">
      <div class="col-sm-9">
        
        
          <div>
  <h2><a href="https://blog.victormendonca.com/2021/02/28/getting-started-with-ansible-molecule/">Getting Started with Ansible Molecule</a>
</h2>

  <div class="margin-10">
    <small>
  <i class="fa fa-calendar"></i>
  <time datetime="2021-02-28">28 Feb, 2021</time>
</small>

    
  <i class="fa fa-tags"></i>
  
  <a href="https://blog.victormendonca.com/tags/linux" class="label label-primary">Linux</a>
  
  <a href="https://blog.victormendonca.com/tags/ansible" class="label label-primary">Ansible</a>
  
  <a href="https://blog.victormendonca.com/tags/docker" class="label label-primary">Docker</a>
  


  </div>
</div>

          <div class="content">
  

<h2 id="overview">Overview</h2>

<p>If you haven&rsquo;t heard about Ansible Molecule you came to the right place. I will cover what it is, it&rsquo;s basic usage, and how to install it and get started.</p>

<h4 id="what-it-is">What it is</h4>

<p><a href="https://molecule.readthedocs.io/en/latest/">Ansible Molecule</a> is a project (tool) that can greatly improve your Ansible workflow. It allows you to automate your tasks (which is great for CI) by providing means of running different and idempotent tests against your roles.</p>

<p>And Molecule is based on Ansible, so you are essentially using Ansible to test Ansible. How cool is that!?</p>

<h4 id="what-it-does">What it does</h4>

<p>To put it in simple words, Molecule tests your code. With Molecule you can easily run multiple tests against your code and make sure it works before deploying to an environment.</p>

<p>Some of the tests you can run are:</p>

<ul>
<li>Yaml lint</li>
<li>Ansible lint</li>
<li>Ansible syntax</li>
<li>Run the Ansible role against a virtual machine</li>
<li>Test idempotence (run the same Ansible role against the same virtual machine for the second time)</li>
</ul>

<h4 id="folder-structure">Folder Structure</h4>

<p>When invoked Molecule creates a single role folder with the usual Ansible structure. Inside this role folder an additional <code>molecule</code> folder is created. This is where the main Molecule configuration lives.</p>

<pre><code class="language-none">$ tree -d
.
├── defaults
├── files
├── handlers
├── molecule
│   └── default
│       ├── converge.yml
│       ├── molecule.yml
│       └── verify.yml
├── tasks
├── templates
├── tests
└── vars
</code></pre>

<h4 id="test-types-and-scenarios">Test Types and Scenarios</h4>

<p>Test scenarios can be configured inside the molecule folder and each scenario should have it&rsquo;s own folder.</p>

<p>A &lsquo;default&rsquo; scenario is created automatically with the following tests enabled (you can change them according to your needs):</p>

<ul>
<li>lint</li>
<li>destroy</li>
<li>dependency</li>
<li>syntax</li>
<li>create</li>
<li>prepare</li>
<li>converge</li>
<li>idempotence</li>
<li>side_effect</li>
<li>verify</li>
<li>destroy</li>
</ul>

<h4 id="drivers">Drivers</h4>

<p>Three different drivers (Vagrant, Docker, and OpenStack) can be used to create virtual machines. These virtual machines are used to test our roles.</p>

<p><em>On this tutorial we will be using Docker as our driver.</em></p>

<h2 id="installing-molecule">Installing Molecule</h2>

<p>Molecule can be installed via pip or with distro packages (depending on your distro). You can mix and match and install Molecule via pip and specific components (like <code>ansible</code> or <code>ansible-lint</code>) via your distro&rsquo;s package manager.</p>

<p><strong>Notes:</strong></p>

<ul>
<li><em>On Windows Molecule can only be installed via WSL</em></li>
<li><em>I&rsquo;m assuming you already have Ansible installed and will not cover it here</em></li>
</ul>

<h3 id="windows-install-ubuntu-wsl">Windows Install (Ubuntu WSL)</h3>

<p>On Ubuntu Molecule needs to be installed via pip. If perhaps you are running another distro in WSL, you can check if the packages are available with your package manager (if you choose to install that way).</p>

<p>Install <code>python-pip</code>.</p>

<pre><code class="language-none">$ sudo apt install -y python-pip
</code></pre>

<p>Create a python virtual environment for Molecule. The software we are going to install will reside in the virtual environment (we can use the environment many times).</p>

<pre><code class="language-none">$ python3 -m venv molecule
</code></pre>

<p>Activate the environment (see that the prompt changes).</p>

<pre><code class="language-none">$ source molecule/bin/activate
(molecule-venv) $
</code></pre>

<p>Install the wheel package.</p>

<pre><code class="language-none">(molecule-venv) $ python3 -m pip install wheel
</code></pre>

<p>Install ansible and ansible-lint. You can do this via Python/Molecule, or via the OS.</p>

<p><em>OS</em></p>

<pre><code class="language-none">$ apt install ansible ansible-lint
</code></pre>

<p><em>Via molecule</em></p>

<pre><code class="language-none">(molecule-venv) $ python3 -m pip install &quot;molecule[ansible]&quot;  # or molecule[ansible-base]
</code></pre>

<p>Install molecule and docker.</p>

<pre><code class="language-none">(molecule-venv) $ python3 -m pip install &quot;molecule[docker,lint]&quot;
</code></pre>

<h3 id="linux-install-arch">Linux Install (Arch)</h3>

<p>If you are running Arch (I use Arch BTW) you can install everything with <code>pacman</code> (or with pip like we did for Windows WSL).</p>

<pre><code class="language-none">$ sudo /usr/bin/pacman -S yamllint ansible-lint molecule molecule-docker
</code></pre>

<h2 id="getting-started">Getting Started</h2>

<h3 id="creating-a-molecule-role">Creating a Molecule Role</h3>

<p>We will now create and configure a role with Molecule using Docker as the driver.</p>

<p>Run <code>molecule init role [role name] -d docker</code>:</p>

<p><img src="https://blog.victormendonca.com/img/getting-started-with-ansible-molecule/getting-started-with-ansible-molecule-28a74.png" alt="" /></p>

<p>This should have created a new role folder with the required molecule files inside.</p>

<h4 id="molecule-yml">molecule.yml</h4>

<p>Holds the default configuration for molecule.</p>

<p><em><code>./myrole/molecule/default/molecule.yml</code></em></p>

<pre><code class="language-yml">---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: instance
    image: docker.io/pycontribs/centos:8
    pre_build_image: true
provisioner:
  name: ansible
verifier:
  name: ansible
</code></pre>

<h4 id="converge-yml">converge.yml</h4>

<p>This is the playbook file that molecule will run.</p>

<p><em><code>./myrole/molecule/default/converge.yml</code></em></p>

<pre><code class="language-yml">---
- name: Converge
  hosts: all
  tasks:
    - name: &quot;Include myrole&quot;
      include_role:
        name: &quot;myrole&quot;
</code></pre>

<h2 id="running-a-simple-test">Running a Simple Test</h2>

<p>Let&rsquo;s use the existing configuration in <code>molecule.yml</code> and <code>converge.yml</code> to run a simple test.</p>

<p>Edit the tasks file (<code>myrole/tasks/main.yml</code>) and add a simple task (you can use the example below with the debug module):</p>

<pre><code class="language-yml">---
# tasks file for myrole

- debug:
    msg: &quot;System {{ inventory_hostname }} has uuid {{ ansible_product_uuid }}&quot;
</code></pre>

<p>Run <code>molecule converge</code> (from the role folder) to build the image and run the playbook.</p>

<script id="asciicast-G8PAulZtu6nNtMobEbLypgLwK" src="https://asciinema.org/a/G8PAulZtu6nNtMobEbLypgLwK.js" async></script>

<p>Now that we got the very basic stuff done, let&rsquo;s move into a bit more advanced steps so we can better understand Molecule and use it with our code.</p>

<h2 id="additional-steps-and-configuration">Additional Steps and Configuration</h2>

<h3 id="adding-lint">Adding Lint</h3>

<p>Lint is not enabled by default, but that can be easily changed by editing <code>molecule.yml</code> and adding the <code>lint</code> key to it:</p>

<pre><code class="language-yaml">dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: instance
    image: docker.io/pycontribs/centos:8
    pre_build_image: true
provisioner:
  name: ansible
verifier:
  name: ansible
lint: |
  set -e
  yamllint .
  ansible-lint .
</code></pre>

<p>Now run <code>molecule lint</code>. You should get a lot of warnings due to to information missing in the meta folder:</p>

<p><img src="https://blog.victormendonca.com/img/getting-started-with-ansible-molecule/getting-started-with-ansible-molecule-d02b3.png" alt="" /></p>

<p>As instructed by the output of the command, you can quiet or disable the messages by adding a <code>warn_list</code> or <code>skip_list</code> to <code>.ansible_lint</code></p>

<p><em><strong>Tip:</strong> You can also fine tune yaml linting by editing <code>.yamllint</code></em></p>

<h3 id="running-a-full-test">Running a Full Test</h3>

<p>So far we have only run two tests:</p>

<ul>
<li>Converge (dependency, create, prepare converge)</li>
<li>Lint (yaml lint and Ansible lint)</li>
</ul>

<p>Let&rsquo;s run a full test (default scenario) on our role. Remember, the full test will run dependency, lint, syntax, create, prepare, converge, idempotence, side_effect, verify, cleanup and destroy.</p>

<p>Run <code>molecule test</code>.</p>

<script id="asciicast-NYNnPRJaYkEHqUwG0mqxiaUli" src="https://asciinema.org/a/NYNnPRJaYkEHqUwG0mqxiaUli.js" async></script>

<h2 id="running-roles-from-another-folder">Running Roles from Another Folder</h2>

<p>You can also use Molecule to test roles from another folder (which makes molecule very flexible for testing).</p>

<p>Let&rsquo;s say I have the following folder structure:</p>

<pre><code class="language-none">.
└── Ansible
    ├── Molecule
    └── web-project
</code></pre>

<p>Inside my <code>web-project</code> folder I have a role called &lsquo;apache&rsquo; that installs (guess what?) httpd.</p>

<p><em><code>./Ansible/web-project/roles/apache/tasks/main.yml</code></em></p>

<pre><code class="language-yml">---
# tasks file for apache

- name: Installs Apache
  yum:
     name: httpd
     state: present
</code></pre>

<p>I can easily modify my existing <code>converge.yml</code> to include that role:</p>

<p><em><code>./Ansible/Molecule/myrole/molecule/default/converge.yml</code></em></p>

<pre><code class="language-yml">---
- name: Converge
  hosts: all
  tasks:
    - name: &quot;Include myrole&quot;
      include_role:
        name: &quot;../../web-project/roles/apache&quot;
</code></pre>

<p>Also edit <code>molecule.yml</code> so we are linting that external folder:</p>

<p><em><code>./Ansible/Molecule/myrole/molecule/default/molecule.yml</code></em></p>

<pre><code class="language-yml">lint: |
  set -e
  yamllint ../../web-project
  ansible-lint ../../web-project
</code></pre>

<p>And then run <code>molecule converge</code> (from the Molecule role folder) to test. Because <code>molecule converge</code> does not include the <code>destroy</code> command, I can login to the container ( with <code>molecule login</code>) and check if httpd was installed:</p>

<p><img src="https://blog.victormendonca.com/img/getting-started-with-ansible-molecule/getting-started-with-ansible-molecule-d229e.png" alt="" /></p>

<p><em><strong>Tip:</strong></em></p>

<ul>
<li><em>When testing against multiple containers you can use <code>molecule login --host [container name]</code></em></li>
<li><em>You can also use docker cli to connect to the container - <code>docker exec -ti [container name] /bin/bash</code></em></li>
</ul>

<p><em><strong>Note:</strong> On this example nothing other than the role is imported (e.g. variables and config from <code>ansible.cfg</code> are not imported)</em></p>

<h3 id="additional-container-configuration">Additional Container Configuration</h3>

<p>We can configure different options for our container in <code>molecule.yml</code> under the platforms key section. Configuration here is similar to a docker compose file.</p>

<ul>
<li><strong>name</strong> - Name of the container</li>
<li><strong>image</strong> - Image for the container. Can be local or from a remote registry</li>
<li><strong>pre_build_image</strong> - Instructs to use pre-build image (pull or local) instead of building from <code>molecule/default/Dockerfile.j2</code></li>
<li><strong>privileged</strong> - Give extended privileges (a &laquo;privileged&raquo; container is given access to all devices)</li>
<li><strong>capabilities</strong> - Same as <code>--cap-add=SYS_ADMIN</code>. Grants a smaller subset of capabilities to the container compared to the privileged option</li>
<li><strong>command</strong> - Same as Dockerfile <code>RUN</code></li>
<li><strong>groups</strong> - Assigns the container to one or more Ansible groups</li>
</ul>

<p>Example:</p>

<pre><code class="language-yml">---
dependency:
  name: galaxy
driver:
  name: podman
platforms:
  - name: rhel8
    image: registry.access.redhat.com/ubi8/ubi-init
    tmpfs:
      - /run
      - /tmp
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
    capabilities:
      - SYS_ADMIN
    command: &quot;/usr/sbin/init&quot;
    pre_build_image: true
  - name: ubuntu
    image: geerlingguy/docker-ubuntu2004-ansible
    tmpfs:
      - /run
      - /tmp
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
    capabilities:
      - SYS_ADMIN
    command: &quot;/lib/systemd/systemd&quot;
    pre_build_image: true
provisioner:
  name: ansible
verifier:
  name: ansible
lint: |
  set -e
  yamllint .
  ansible-lint .
</code></pre>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>I&rsquo;m hoping I was able to provide you with enough information on how to get started with Molecule. If you have any comments, suggestions or corrections, please leave them in the comment box below.</p>

</div>


          <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.victormendonca.com%2f2021%2f02%2f28%2fgetting-started-with-ansible-molecule%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Getting%20Started%20with%20Ansible%20Molecule&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f02%2f28%2fgetting-started-with-ansible-molecule%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f02%2f28%2fgetting-started-with-ansible-molecule%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f02%2f28%2fgetting-started-with-ansible-molecule%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f02%2f28%2fgetting-started-with-ansible-molecule%2f&amp;title=Getting%20Started%20with%20Ansible%20Molecule" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Getting%20Started%20with%20Ansible%20Molecule&amp;body=Check out this site https%3a%2f%2fblog.victormendonca.com%2f2021%2f02%2f28%2fgetting-started-with-ansible-molecule%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://blog.victormendonca.com/2021/01/23/how-to-convert-standard-partition-to-lvm/" title="How to Convert Standard Partition to Logical Volume">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//victorbrca-github-io.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

        
          <div>
  <h2><a href="https://blog.victormendonca.com/2021/01/23/how-to-convert-standard-partition-to-lvm/">How to Convert Standard Partition to Logical Volume</a>
</h2>

  <div class="margin-10">
    <small>
  <i class="fa fa-calendar"></i>
  <time datetime="2021-01-23">23 Jan, 2021</time>
</small>

    
  <i class="fa fa-tags"></i>
  
  <a href="https://blog.victormendonca.com/tags/linux" class="label label-primary">Linux</a>
  


  </div>
</div>

          <div class="content">
  

<h2 id="preamble">Preamble</h2>

<p>When I bought my new and shinny Lenovo P1 at the beginning of the year I choose a configuration that had 2 NVMe drives; one of 500GB and the other of 256GB. Innocently I thought that this would be plenty. But since I started hogging my test VMs and creating videos with my GoPro and DaVinci Resolve (while we are here, check out my <a href="https://www.youtube.com/channel/UCWcwZKLVqBzxCSUuoPmZKMw">YouTube</a> channel), that storage space quickly became too small and I knew I had to update my storage!</p>

<p>Taking advantage of a great Black Friday deal I scored a 1TB Samsung 970 Evo Plus NVMe drive for almost half the price.</p>

<p><img src="https://blog.victormendonca.com/img/how-to-convert-standard-partition-to-lvm/how-to-convert-standard-partition-to-lvm-9d243.png" alt="" /></p>

<h2 id="preparation">Preparation</h2>

<p>I had my hard drives organized into partitions as follows:</p>

<pre><code class="language-none">nvme0n1             259:0    0 476.9G  0 disk
├─nvme0n1p1         259:1    0   250G  0 part /home
└─nvme0n1p2         259:2    0 226.9G  0 part /mnt/storage2
nvme1n1             259:3    0   256G  0 disk
├─nvme1n1p1         259:4    0   512M  0 part /efi
├─nvme1n1p2         259:6    0    32G  0 part [SWAP]
├─nvme1n1p2         259:7    0   110G  0 part /
└─nvme1n1p2         259:8    0    96G  0 part /mnt/storage1
</code></pre>

<p><em>The partitions &lsquo;storage1&rsquo; and &lsquo;storage2&rsquo; are used for video and virtual machine storage.</em></p>

<p>My plan was to replace the smaller drive and copy my partitions to the new drive as LV. This is pretty straight forward, you just need some additional steps if your root partition will be in the LV. I&rsquo;m however leaving my EFI partition as a standard partition for simplicity and compatibility.</p>

<p>If you are using this post as a guide, please take the time to compare my configuration to yours and make sure that it will work for you. You will most likely need to tweak a few steps. Also note that I&rsquo;m running Arch, so my instructions will be directed to it.</p>

<p>And finally, if you are adding a new drive, don&rsquo;t forget to do it now. I installed the new drive and used a USB-C enclosure to access my old drive.</p>

<p><strong>⚠️ WARNING:</strong> <em>We will be using <code>dd</code> to copy the old data. Make sure to select the right partition and more importatnly, the right direction because <code>dd</code> will erase all your data.</em></p>

<p><em>New NVMe installed</em>
<img src="https://blog.victormendonca.com/img/how-to-convert-standard-partition-to-lvm/how-to-convert-standard-partition-to-lvm-6f0d9.png" alt="" /></p>

<h2 id="instructions">Instructions</h2>

<h3 id="creating-the-lv-and-copying-the-data">Creating the LV and Copying the Data</h3>

<p>a. <strong>Power off</strong> the machine and boot into an Arch install ISO</p>

<p>b. Create an EFI and a LVM partition using gdisk (I&rsquo;m not getting in details on this, but there are plenty of tutorials online). Make sure the EFI partition is the same size as your old one</p>

<p><em>Here&rsquo;s my layout. My the new drive shows as <code>/dev/nvme1n1</code></em></p>

<pre><code class="language-none">Device           Start        End    Sectors  Size Type
/dev/nvme1n1p1    2048    1050623    1048576  512M EFI System
/dev/nvme1n1p2 1050624 1953525134 1952474511  931G Linux LVM
</code></pre>

<p>c. Copy the old EFI partition to the new EFI partition with dd (note that my old drive mounted via the USB-C enclosure now shows as <code>/dev/sdb</code>)</p>

<pre><code class="language-none"># dd if=/dev/sdb1 of=/dev/nvme1n1p1 bs=4M
</code></pre>

<p>d. Create the PV/VG</p>

<pre><code class="language-none"># vgcreate root_vg /dev/nvme1n1p2
</code></pre>

<p>e. Create the logical volumes. Make sure that they have the same size as the old partitions</p>

<pre><code class="language-none"># lvcreate -n swap -L 32G root_vg
# lvcreate -n root -L 110G root_vg
# lvcreate -n storage -L 96G root_vg
</code></pre>

<p>f. Formart the swap partition (there&rsquo;s not need to copy it, so we just recreate it)</p>

<pre><code class="language-none"># mkswap -L swap /dev/root_vg/swap
</code></pre>

<p>g. Copy the root partition</p>

<pre><code class="language-none"># dd if=/dev/sdb3 of=/dev/root_vg/root bs=4M
</code></pre>

<p>h. Copy the storage partition (or any other partition if you had it)</p>

<pre><code class="language-none"># dd if=/dev/sdb4 of=/dev/root_vg/storage bs=4M
</code></pre>

<p>i. Our new drive is now created and populated with the old data</p>

<pre><code class="language-none"># lsblk
nvme0n1             259:0    0 476.9G  0 disk
├─nvme0n1p1         259:1    0   250G  0 part /home
└─nvme0n1p2         259:2    0 226.9G  0 part /mnt/storage2
nvme1n1             259:3    0 931.5G  0 disk
├─nvme1n1p1         259:4    0   512M  0 part /efi
└─nvme1n1p2         259:5    0   931G  0 part
  ├─root_vg-swap    254:0    0    32G  0 lvm  [SWAP]
  ├─root_vg-root    254:1    0   110G  0 lvm  /
  └─root_vg-storage 254:2    0    96G  0 lvm  /mnt/storage1
</code></pre>

<h3 id="additional-configuration">Additional Configuration</h3>

<p>We now need to fix our EFI and GRUB to make sure we can boot into our LV partition.</p>

<p>a. Mount root</p>

<pre><code class="language-none"># mkdir /mnt/root

# mount /dev/root_vg/root /mnt/root
</code></pre>

<p>b. Enter chroot of our copied data</p>

<pre><code class="language-none"># arch-chroot /mnt/root
</code></pre>

<p>c. Mount our EFI partition</p>

<pre><code class="language-none"># mount /dev/nvme1n1p1 /efi
</code></pre>

<p>d. Fix fstab for the swap partition (because we did not copy our swap partition, a new UUID was generated. We need to change <code>/etc/fstab</code> with that new partition UUID)</p>

<pre><code class="language-none">UUID=d9e1b4f1-40eb-4bb6-908c-33012c7c0902	none		swap		defaults	0 0
</code></pre>

<p>e. Edit <code>/etc/mkinitcpio.conf</code> and add <code>lvm2</code> to <code>HOOKS</code></p>

<pre><code class="language-none">HOOKS=(base udev ... block lvm2 filesystems)
</code></pre>

<p>f. Generate the ramdisk environment to boot the kernel</p>

<pre><code class="language-none"># mkinitcpio -P
</code></pre>

<p>g. Re-install GRUB</p>

<pre><code class="language-none"># grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB
</code></pre>

<p>h. Enable the LVM module for GRUB by editing <code>/etc/default/grub</code> and adding the <code>lvm</code> module to <code>GRUB_PRELOAD_MODULES</code></p>

<pre><code class="language-none"># Preload both GPT and MBR modules so that they are not missed
GRUB_PRELOAD_MODULES=&quot;part_gpt part_msdos lvm&quot;
</code></pre>

<p>i. Re-create GRUB config</p>

<pre><code class="language-none"># grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>

<p>j. Unmount /efi</p>

<pre><code class="language-none"># umount /efi
</code></pre>

<p>k. Exit chroot</p>

<pre><code class="language-none"># exit
</code></pre>

<p>l. Unmount root</p>

<pre><code class="language-none"># umount /mnt/root
</code></pre>

<p>m. Power off, remove the old drive and the Arch iso and reboot</p>

<pre><code class="language-none"># poweroff
</code></pre>

<p>If everything was done correctly you should be able to boot your system normally. If something is not working don&rsquo;t panic. Your data should be safe and sound on your old drive. Review your steps, do additional research for anything specific to your configuration and try again.</p>

<hr />

<p><strong>Reference:</strong></p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Install_Arch_Linux_on_LVM">Arch Wiki: Install Arch Linux on LVM</a></li>
<li><a href="https://wiki.archlinux.org/index.php/LVM#Getting_started">Arch Wiki: LVM</a></li>
</ul>

</div>


          <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.victormendonca.com%2f2021%2f01%2f23%2fhow-to-convert-standard-partition-to-lvm%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=How%20to%20Convert%20Standard%20Partition%20to%20Logical%20Volume&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f01%2f23%2fhow-to-convert-standard-partition-to-lvm%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f01%2f23%2fhow-to-convert-standard-partition-to-lvm%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f01%2f23%2fhow-to-convert-standard-partition-to-lvm%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2021%2f01%2f23%2fhow-to-convert-standard-partition-to-lvm%2f&amp;title=How%20to%20Convert%20Standard%20Partition%20to%20Logical%20Volume" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=How%20to%20Convert%20Standard%20Partition%20to%20Logical%20Volume&amp;body=Check out this site https%3a%2f%2fblog.victormendonca.com%2f2021%2f01%2f23%2fhow-to-convert-standard-partition-to-lvm%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://blog.victormendonca.com/2020/11/18/linux-logical-volume-manager/" title="RHCSA v8: Linux Logical Volume Manager">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://blog.victormendonca.com/2021/02/28/getting-started-with-ansible-molecule/" title="Getting Started with Ansible Molecule">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//victorbrca-github-io.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

        
          <div>
  <h2><a href="https://blog.victormendonca.com/2020/11/18/linux-logical-volume-manager/">RHCSA v8: Linux Logical Volume Manager</a>
</h2>

  <div class="margin-10">
    <small>
  <i class="fa fa-calendar"></i>
  <time datetime="2020-11-18">18 Nov, 2020</time>
</small>

    
  <i class="fa fa-tags"></i>
  
  <a href="https://blog.victormendonca.com/tags/linux" class="label label-primary">Linux</a>
  
  <a href="https://blog.victormendonca.com/tags/redhat" class="label label-primary">RedHat</a>
  
  <a href="https://blog.victormendonca.com/tags/rhcsa" class="label label-primary">RHCSA</a>
  


  </div>
</div>

          <div class="content">
  

<h4 id="disclaimer">Disclaimer</h4>

<p>This blog post is essentially my study notes for the RHCSA v8 exam on Logical Volume Manager. It should be taken as a quick reference document (or a cheat sheet of some sorts).</p>

<p>It covers the following exam subjects:</p>

<ul>
<li><strong>Configure local storage</strong>

<ul>
<li>Create and remove physical volumes</li>
<li>Assign physical volumes to volume groups</li>
<li>Create and delete logical volumes</li>
</ul></li>
<li><strong>Create and configure file systems</strong>

<ul>
<li>Extend existing logical volumes</li>
</ul></li>
</ul>

<p><em><strong>Note:</strong> There could be additional information needed for the exam that is not covered here.</em></p>

<h2 id="overview">Overview</h2>

<p>Logical Volume Manager (LVM) is a device mapper target that provides logical volume management for the Linux kernel. LVM allows a pool of space to manage storage.</p>

<p><img src="https://blog.victormendonca.com/img/linux-logical-volume-manager/lvm.png" alt="" /></p>

<p><strong>PV</strong> - Physical Volumes are directly related to hard drives or partitions</p>

<p><strong>VG</strong> - A Volume Group can have multiple physical Volumes</p>

<p><strong>LV</strong> - A Logical Volume sits inside a Volume Group and it&rsquo;s what is assigned to a file system.</p>

<p>The filesystem sits on top of the logical volume and it will be formatted to a specifc fs type (vfat, xfs, ext4) and mounted (/root, /home, /mnt/*, etc).</p>

<p>When a physical disk is setup for LVM, metadata is written at the beginning of the disk for normal usage, and at the end of the disk for backup usage.</p>

<h3 id="overview-of-creating-a-physical-volume">Overview of Creating a Physical Volume</h3>

<p>First create initialize the disks to be used by LVM with <code>pvcreate</code> (Initialize physical volume(s) for use by LVM)</p>

<pre><code># pvcreate /dev/device /dev/device2 /dev/device3
</code></pre>

<p>Then we create a volume group with <code>vgcreate</code> (Create a volume group)</p>

<pre><code># vgcreate [vg name] /dev/device /dev/device2 /dev/device3
</code></pre>

<p><em>Optionally use the <code>-s</code> switch to set the Physical Extent size (for LVM2, the only effect this flag has is that when using too many physical volumes, the LVM tools will perform better)</em></p>

<p>Create the Logical Volume (4GB)</p>

<pre><code># lvcreate -L 4g [vg name] -n [lv name]
</code></pre>

<p>Flags:</p>

<ul>
<li><code>-n</code>  - set the Logical Volume name</li>
<li><code>-l</code> - use extents rather than a specified size</li>
</ul>

<p>And finally create the file system</p>

<pre><code># mkfs.xfs /dev/[vgname]/[lvname]
</code></pre>

<hr />

<h2 id="working-with-lvm">Working With LVM</h2>

<h3 id="physical-volumes">Physical Volumes</h3>

<p><strong>Commands reference:</strong></p>

<ul>
<li>lvm (8)                  - LVM2 tools</li>
<li>pvcreate (8)         - Initialize physical volume(s) for use by LVM</li>
<li>pvdisplay (8)        - Display various attributes of physical volume(s)</li>
<li>pvremove (8)         - Remove LVM label(s) from physical volume(s)</li>
<li>pvs (8)                  - Display information about physical volumes</li>
</ul>

<h4 id="creating-physical-volumes">Creating Physical Volumes</h4>

<p>Physical volumes can be created using full disks or partitions.</p>

<pre><code># pvcreate /dev/part1 /dev/part2
</code></pre>

<p>Or</p>

<pre><code># pvcreate /dev/sdb /dev/sdc
</code></pre>

<h4 id="deleting-physical-volumes">Deleting Physical Volumes</h4>

<p><code>pvremove</code> wipes the label on a device so that LVM will no longer recognize it as a PV. A PV cannot be removed from a VG while it is used by an active LV.</p>

<p>Removing a PV</p>

<pre><code class="language-none"># pvremove /dev/sdb /dev/sdc
  Labels on physical volume &quot;/dev/sdb&quot; successfully wiped.
  Labels on physical volume &quot;/dev/sdc&quot; successfully wiped.
</code></pre>

<p>Trying to remove a PV that has a VG and LV</p>

<pre><code class="language-none"># pvremove /dev/sdb /dev/sdc
  PV /dev/sdb is used by VG testvg so please use vgreduce first.
  (If you are certain you need pvremove, then confirm by using --force twice.)
  /dev/sdb: physical volume label not removed.
  PV /dev/sdc is used by VG testvg so please use vgreduce first.
  (If you are certain you need pvremove, then confirm by using --force twice.)
  /dev/sdc: physical volume label not removed.
</code></pre>

<p>You can try to force remove with <code>-ff</code></p>

<pre><code class="language-none"># pvremove -ff /dev/sdb /dev/sdc
  WARNING: PV /dev/sdb is used by VG testvg.
Really WIPE LABELS from physical volume &quot;/dev/sdb&quot; of volume group &quot;testvg&quot; [y/n]? y
  WARNING: Wiping physical volume label from /dev/sdb of volume group &quot;testvg&quot;.
  WARNING: PV /dev/sdc is used by VG testvg.
  Really WIPE LABELS from physical volume &quot;/dev/sdc&quot; of volume group &quot;testvg&quot; [y/n]? y
  WARNING: Wiping physical volume label from /dev/sdc of volume group &quot;testvg&quot;.
</code></pre>

<h3 id="volume-groups">Volume Groups</h3>

<p><strong>Commands reference:</strong></p>

<ul>
<li>lvm (8)                  - LVM2 tools</li>
<li>vgcreate (8)         - Create a volume group</li>
<li>vgdisplay (8)        - Display volume group information</li>
<li>vgextend (8)        - Add physical volumes to a volume group</li>
<li>vgreduce (8)        - Remove physical volume(s) from a volume group</li>
<li>vgremove (8)      - Remove volume group(s)</li>
<li>vgs (8)                  - Display information about volume groups</li>
</ul>

<h4 id="creating-a-volume-group">Creating a Volume Group</h4>

<p><code>vgcreate</code> creates a new VG on block devices. If the devices were not previously intialized as PVs with <code>pvcreate</code>, <code>vgcreate</code> will inititialize them, making them PVs. The <code>pvcreate</code> options for initializing devices are also available with <code>vgcreate</code>.</p>

<p>We create a volume group with <code>vgcreate</code></p>

<pre><code># vgcreate [vg name] /dev/device /dev/device2 /dev/device3
</code></pre>

<p><em>For example:</em></p>

<pre><code class="language-none"># vgcreate vg1 /dev/sdb /dev/sdc
  Volume group &quot;vg1&quot; successfully created
</code></pre>

<h4 id="listing-the-volume-group">Listing the volume group</h4>

<pre><code class="language-none"># vgs vg1
  VG   #PV #LV #SN Attr   VSize   VFree
  vg1    2   0   0 wz--n-   5.99g 5.99g
</code></pre>

<p>Or with more details</p>

<pre><code class="language-none"># vgdisplay vg1
  --- Volume group ---
  VG Name               vg1
  System ID              
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               5.99 GiB
  PE Size               4.00 MiB
  Total PE              1534
  Alloc PE / Size       0 / 0    
  Free  PE / Size       1534 / 5.99 GiB
  VG UUID               uvHpRZ-BdPH-Nzxy-Lp15-VMps-fzPZ-A1bebc
</code></pre>

<p>You can also create a PV with <code>vgcreate</code> (bypassing the need to run <code>pvcreate</code>)</p>

<pre><code class="language-none"># vgcreate vg2 /dev/sdd
  Physical volume &quot;/dev/sdd&quot; successfully created.
  Volume group &quot;vg2&quot; successfully created
</code></pre>

<h4 id="extending-a-volume-group">Extending a Volume Group</h4>

<p>You can use <code>vgextend</code> to extend volume groups by adding physical volumes to it.</p>

<p>Initialize the new drive as a physical volume with <code>pvcreate</code></p>

<pre><code class="language-none"># pvcreate /dev/sde
  Physical volume &quot;/dev/sde&quot; successfully created.
</code></pre>

<p>Then Add the new physical volume to the volume group</p>

<pre><code class="language-none"># vgextend vg1 /dev/sde
  Volume group &quot;vg1&quot; successfully extended
</code></pre>

<h4 id="reducing-a-volume-group">Reducing a Volume Group</h4>

<p><code>vgreduce</code> removes one or more unused PVs from a VG.</p>

<p>List the volume group (note it has 8.99GB of space)</p>

<pre><code class="language-none"># vgs vg1
  VG  #PV #LV #SN Attr   VSize  VFree  
  vg1   3   0   0 wz--n- &lt;8.99g &lt;8.99g
</code></pre>

<p>Remove one of the physical volumes</p>

<pre><code class="language-none"># vgreduce vg1 /dev/sde
  Removed &quot;/dev/sde&quot; from volume group &quot;vg1&quot;
</code></pre>

<p>List the volume group again (now it has 5.99GB)</p>

<pre><code class="language-none"># vgs vg1
  VG  #PV #LV #SN Attr   VSize VFree
  vg1   2   0   0 wz--n- 5.99g 5.99g
</code></pre>

<h4 id="deleting-removing-a-volume-group">Deleting/Removing a Volume Group</h4>

<p><code>vgremove</code> removes one or more VGs. If LVs exist in the VG, a prompt is used to confirm LV removal.</p>

<pre><code class="language-none"># vgremove vg1
  Volume group &quot;vg1&quot; successfully removed
</code></pre>

<h3 id="logical-volumes">Logical Volumes</h3>

<p><strong>Commands reference:</strong></p>

<ul>
<li>lvm (8)                  - LVM2 tools</li>
<li>lvcreate (8)          - Create a logical volume</li>
<li>lvdisplay (8)         - Display information about a logical volume</li>
<li>lvextend (8)         - Add space to a logical volume</li>
<li>lvresize (8)           - Resize a logical volume</li>
<li>lvreduce (8)         - Reduce the size of a logical volume</li>
<li>lvremove (8)         - Remove logical volume(s) from the system</li>
<li>lvs (8)                   - Display information about logical volumes</li>
</ul>

<h4 id="creating-a-logical-volume">Creating a Logical Volume</h4>

<pre><code># lvcreate -L 4g [vg name] -n [lv name]
</code></pre>

<p><strong>Flags:</strong></p>

<ul>
<li><code>-n</code>  - set the Logical Volume name</li>
<li><code>-l</code> - use extents rather than a specified size</li>
</ul>

<h5 id="example">Example</h5>

<p>Create the LV</p>

<pre><code class="language-none"># lvcreate -L 4g vg1 -n lv1
WARNING: ext4 signature detected on /dev/vg1/lv1 at offset 1080. Wipe it? [y/n]: y
  Wiping ext4 signature on /dev/vg1/lv1.
  Logical volume &quot;lv1&quot; created.
</code></pre>

<p>Display simple information about the LV</p>

<pre><code class="language-none"># lvs vg1
  LV   VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv1  vg1 -wi-a----- 4.00g   
</code></pre>

<p>Simple information with verbose</p>

<pre><code class="language-none"># lvs -v vg1
  LV   VG  #Seg Attr       LSize Maj Min KMaj KMin Pool Origin Data%  Meta%  Move Cpy%Sync Log Convert LV UUID                                LProfile
  lv1  vg1    2 -wi-a----- 4.00g  -1  -1  253    2                                                     ADUPcG-YAuo-5vDC-7FEB-Cas9-4Gt0-hR1kVD  
</code></pre>

<p>Detailed information</p>

<pre><code class="language-none"># lvdisplay vg1
  --- Logical volume ---
  LV Path                /dev/vg1/lv1
  LV Name                lv1
  VG Name                vg1
  LV UUID                ADUPcG-YAuo-5vDC-7FEB-Cas9-4Gt0-hR1kVD
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2020-11-18 08:07:29 -0500
  LV Status              available
  # open                 0
  LV Size                4.00 GiB
  Current LE             1024
  Segments               2
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
</code></pre>

<h4 id="extending-a-logical-volume">Extending a Logical Volume</h4>

<p><code>lvextend</code> adds space to a logical volume. The space needs to be available in the volume group.</p>

<p>When extending Logical Volumes, you do not need to unmount the partition (however you will need to extend the file system afterwards, or if the filesystems supports, use the &lsquo;-r&rsquo; flag to automatically resize the filesystem).</p>

<h5 id="checking-for-available-space">Checking for available space</h5>

<p>Use <code>vgs</code> to see the available space of the volume group</p>

<pre><code class="language-none"># vgs vg1
  VG  #PV #LV #SN Attr   VSize  VFree  
  vg1   3   1   0 wz--n- &lt;8.99g &lt;4.99g
                           |      |- Available VG space (not allocated to a LV)
                           |- Total size of VG
</code></pre>

<p>You can use <code>lvs</code> to confirm that the LV is using the difference of the previous values</p>

<pre><code class="language-none"># lvs vg1
  LV   VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv1  vg1 -wi-a----- 4.00g  
</code></pre>

<p>Or just use <code>vgdisplay</code> and check the PE sizes</p>

<pre><code class="language-none"># vgdisplay vg1 | grep 'PE /'
  Alloc PE / Size       1024 / 4.00 GiB
  Free  PE / Size       1277 / &lt;4.99 GiB
</code></pre>

<h5 id="extending-the-logical-volume">Extending the Logical Volume</h5>

<p>Extend volume to specified size (k/m/g)</p>

<pre><code class="language-none"># lvextend -L6G /dev/vg1/lv1
  Size of logical volume vg1/lv1 changed from 5.39 GiB (1381 extents) to 6.00 GiB (1536 extents).
  Logical volume vg1/lv1 successfully resized.
</code></pre>

<p>Extend the volume by 1GB</p>

<pre><code class="language-none"># lvextend -L+1G /dev/vg1/lv1
  Size of logical volume vg1/lv1 changed from 6.00 GiB (1536 extents) to 7.00 GiB (1792 extents).
  Logical volume vg1/lv1 successfully resized.
</code></pre>

<p>Extend for the full available space in the VG</p>

<pre><code class="language-none"># lvextend -l +100%FREE /dev/vg1/lv1
  Size of logical volume vg1/lv1 changed from 7.00 GiB (1792 extents) to &lt;8.99 GiB (2301 extents).
  Logical volume vg1/lv1 successfully resized.
</code></pre>

<p><em>Note that <code>lvextend -l 100%FREE /dev/vg1/lv1</code> (without the plus size) will not work</em></p>

<p>Extend to the percentage of the VG (60% or 8.99 = 5.394)</p>

<pre><code class="language-none"># lvextend -l 60%VG /dev/vg1/lv1
  Size of logical volume vg1/lv1 changed from 4.00 GiB (1024 extents) to 5.39 GiB (1381 extents).
  Logical volume vg1/lv1 successfully resized.
</code></pre>

<p>You can also use the &lsquo;PE&rsquo; size</p>

<pre><code class="language-none"># lvextend -l +1740 /dev/RHCSA/pinehead  
  Size of logical volume RHCSA/pinehead changed from &lt;3.20 GiB (818 extents) to 9.99 GiB (2558 extents).
  Logical volume RHCSA/pinehead successfully resized.
</code></pre>

<h4 id="shrinking-a-logical-volume">Shrinking a Logical Volume</h4>

<p>Be careful when reducing an LV&rsquo;s size, because data in the reduced area is lost. Ensure that any file system on the LV is resized before running <code>lvreduce</code> so that the removed extents are not in use by the file system.</p>

<p>You can use two commands to shrink a logical volume:</p>

<ul>
<li><strong>lvreduce</strong> reduces the size of an LV. The freed logical extents are returned to the VG to be used by other LVs.</li>
<li><strong>lvresize</strong>  resizes  an  LV  in  the same way as <code>lvextend</code> and <code>lvreduce</code>.</li>
</ul>

<p>Shrink a logical volume by 2GB</p>

<pre><code class="language-none"># lvresize -L-2G /dev/vg1/lv1
  WARNING: Reducing active logical volume to &lt;6.99 GiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce vg1/lv1? [y/n]: y
  Size of logical volume vg1/lv1 changed from &lt;8.99 GiB (2301 extents) to &lt;6.99 GiB (1789 extents).
  Logical volume vg1/lv1 successfully resized.
</code></pre>

<p>Shrink a logical volume to 30% of the volume group size</p>

<pre><code class="language-none"># lvreduce -l 30%VG  /dev/vg1/lv1
  WARNING: Reducing active logical volume to &lt;2.70 GiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce vg1/lv1? [y/n]: y
  Size of logical volume vg1/lv1 changed from &lt;6.99 GiB (1789 extents) to &lt;2.70 GiB (691 extents).
  Logical volume vg1/lv1 successfully resized.
</code></pre>

<h4 id="deleting-removing-a-logical-volume">Deleting/Removing a Logical Volume</h4>

<p><code>lvremove</code>  removes one or more LVs. For standard LVs, this returns the logical extents that were used by the LV to the VG for use by other LVs.</p>

<pre><code class="language-none"># lvremove /dev/vg1/lv1
Do you really want to remove active logical volume vg1/lv1? [y/n]: y
  Logical volume &quot;lv1&quot; successfully removed
</code></pre>

</div>


          <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f18%2flinux-logical-volume-manager%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=RHCSA%20v8%3a%20Linux%20Logical%20Volume%20Manager&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f18%2flinux-logical-volume-manager%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f18%2flinux-logical-volume-manager%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f18%2flinux-logical-volume-manager%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f18%2flinux-logical-volume-manager%2f&amp;title=RHCSA%20v8%3a%20Linux%20Logical%20Volume%20Manager" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=RHCSA%20v8%3a%20Linux%20Logical%20Volume%20Manager&amp;body=Check out this site https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f18%2flinux-logical-volume-manager%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://blog.victormendonca.com/2020/11/14/rhcsa8-boot-targets-system-targets-and-root-password-reset/" title="RHCSA v8: Boot Targets, Systemd Targets and root Password Reset">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://blog.victormendonca.com/2021/01/23/how-to-convert-standard-partition-to-lvm/" title="How to Convert Standard Partition to Logical Volume">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//victorbrca-github-io.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

        
          <div>
  <h2><a href="https://blog.victormendonca.com/2020/11/14/rhcsa8-boot-targets-system-targets-and-root-password-reset/">RHCSA v8: Boot Targets, Systemd Targets and root Password Reset</a>
</h2>

  <div class="margin-10">
    <small>
  <i class="fa fa-calendar"></i>
  <time datetime="2020-11-14">14 Nov, 2020</time>
</small>

    
  <i class="fa fa-tags"></i>
  
  <a href="https://blog.victormendonca.com/tags/linux" class="label label-primary">Linux</a>
  
  <a href="https://blog.victormendonca.com/tags/redhat" class="label label-primary">RedHat</a>
  
  <a href="https://blog.victormendonca.com/tags/rhcsa" class="label label-primary">RHCSA</a>
  
  <a href="https://blog.victormendonca.com/tags/systemd" class="label label-primary">Systemd</a>
  


  </div>
</div>

          <div class="content">
  

<p>For quite a while the RHCSA exam has covered topics related to boot targets and the famous root password reset. However, with the introduction of systemd and other related changes this can sometimes become a bit confusing. The methods that were once used for RHEL 6/7 may no longer be available or may not be the &lsquo;official&rsquo; way of doing things anymore.</p>

<p>I will try to clear some of the differences so we can have a better understanding of what&rsquo;s needed for the RHCSAv8 exam.</p>

<h4 id="exam-topics-we-will-cover">Exam Topics we will cover</h4>

<p><a href="https://www.redhat.com/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam?section=Objectives">Red Hat Certified System Administrator (RHCSA) exam objectives</a></p>

<p><strong>Operate running systems</strong></p>

<ul>
<li>Boot systems into different targets manually</li>
<li>Interrupt the boot process in order to gain access to a system</li>
</ul>

<h2 id="boot-targets">Boot Targets</h2>

<p>On this section I will cover topics related to the &lsquo;<em>Boot systems into different targets manually</em>&rsquo; objective.</p>

<h3 id="olders-sysv">Olders SysV</h3>

<p>SysV is an older startup mechanism that was used by many Unix-like operating systems. It was replaced by Systemd and it&rsquo;s no longer used by Red Hat. However, you will sill find commands that references SysV and it&rsquo;s run levels.</p>

<p><em>From Red Hat Enterprise Linux 3: Reference Guide</em></p>

<blockquote>
<p>The SysV init runlevel system provides a standard process for controlling which programs init launches or halts when initializing a runlevel. SysV init was chosen because it is easier to use and more flexible than the traditional BSD-style init process.</p>
</blockquote>

<p>The following runlevels are defined by default for Red Hat Enterprise Linux:</p>

<pre><code class="language-none">0 — Halt
1 — Single-user text mode
2 — Not used (user-definable)
3 — Full multi-user text mode
4 — Not used (user-definable)
5 — Full multi-user graphical mode (with an X-based login screen)
6 — Reboot
</code></pre>

<h5 id="sysv-commands">SysV Commands</h5>

<p>You can find what runlevel the system currently is by executing the command <code>runlevel</code></p>

<pre><code class="language-none"># runlevel
N 5
</code></pre>

<p>And you can change the system runlevel by running <code>telinit</code> with a runlevel number (0-6)</p>

<pre><code class="language-none"># telini 6
</code></pre>

<p><strong>📝 NOTE:</strong> <em>You should not be using SysV commands to change the runlevels. You should use systemd commands instead.</em></p>

<h3 id="systemd-targets">Systemd Targets</h3>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-services-with-systemd_configuring-basic-system-settings#working-with-systemd-targets_managing-services-with-systemd">RHEL 8 &gt; Configuring basic system settings &gt; Chapter 3. Managing services with systemd &gt; 3.3. Working with systemd targets</a></p>

<p>Systemd targets are similar to SysV runlevels, and they are what you should use/reference from now on (including for the RHCSAv8 exam).</p>

<p><em>From Arch Wiki</em></p>

<blockquote>
<p>systemd uses targets to group units together via dependencies and as standardized synchronization points. They serve a similar purpose as runlevels but act a little differently. Each target is named instead of numbered and is intended to serve a specific purpose with the possibility of having multiple ones active at the same time.</p>
</blockquote>

<h4 id="runlevels-and-systemd">Runlevels and Systemd</h4>

<p>While runlevels are not used anymore, they are still referenced (by older codes and such). Systemd provides a compatibility layer to it&rsquo;s targets.</p>

<p><em>From <code>runlevel</code> man page</em></p>

<blockquote>
<p>&laquo;Runlevels&raquo; are an obsolete way to start and stop groups of services used in SysV init. systemd
 provides a compatibility layer that maps runlevels to targets, and associated binaries like
 runlevel. Nevertheless, only one runlevel can be &laquo;active&raquo; at a given time, while systemd can
 activate multiple targets concurrently, so the mapping to runlevels is confusing and only
 approximate. Runlevels should not be used in new code, and are mostly useful as a shorthand way
 to refer the matching systemd targets in kernel boot parameters.</p>
</blockquote>

<p><img src="https://blog.victormendonca.com/img/rhcsa8-boot-targets-system-targets-and-root-password-reset/runlevel-table.png" alt="" /></p>

<h4 id="working-with-systemd-targets">Working with Systemd Targets</h4>

<p>Let&rsquo;s go through the commands that will allow us to list, view and change the Systemd targets.</p>

<p><strong>Listing the available targets</strong></p>

<pre><code class="language-none"># systemctl list-units --type=target

UNIT                   LOAD   ACTIVE SUB    DESCRIPTION                 
basic.target           loaded active active Basic System                
cryptsetup.target      loaded active active Local Encrypted Volumes     
getty.target           loaded active active Login Prompts               
graphical.target       loaded active active Graphical Interface         
local-fs-pre.target    loaded active active Local File Systems (Pre)    
local-fs.target        loaded active active Local File Systems          
multi-user.target      loaded active active Multi-User System           
network-online.target  loaded active active Network is Online           
network-pre.target     loaded active active Network (Pre)               
network.target         loaded active active Network                     
nfs-client.target      loaded active active NFS client services         
nss-user-lookup.target loaded active active User and Group Name Lookups
paths.target           loaded active active Paths                       
remote-fs-pre.target   loaded active active Remote File Systems (Pre)   
remote-fs.target       loaded active active Remote File Systems         
rpc_pipefs.target      loaded active active rpc_pipefs.target           
rpcbind.target         loaded active active RPC Port Mapper             
slices.target          loaded active active Slices                      
sockets.target         loaded active active Sockets                     
sound.target           loaded active active Sound Card                  
sshd-keygen.target     loaded active active sshd-keygen.target          
swap.target            loaded active active Swap                        
sysinit.target         loaded active active System Initialization       
timers.target          loaded active active Timers  
</code></pre>

<p><strong>Get the current target</strong></p>

<pre><code class="language-none"># systemctl get-default
graphical.target
</code></pre>

<p><strong>Set the Systemd target for next boot</strong></p>

<pre><code class="language-none"># systemctl set-default [target]
</code></pre>

<p><strong>Change the Systemd target without reboot</strong></p>

<pre><code class="language-none"># systemctl isolate [target]
</code></pre>

<p><strong>Change into rescue/emergency mode</strong></p>

<p><em><strong>Note:</strong> This is related to the next session where we will cover rescue modes.</em></p>

<pre><code class="language-none"># systemctl isolate [rescue|emergency]

or

# systemctl [rescue|emergency]
</code></pre>

<h2 id="rescue-modes">Rescue Modes</h2>

<p><em>This section is related to the &lsquo;Interrupt the boot process in order to gain access to a system&rsquo; objective.</em></p>

<p>Rescue and emergency modes allow you to boot the OS with very few services running and perform administrative tasks to attempt to resolve/repair/recover the system.</p>

<p>There are different types of rescue and emergency modes:</p>

<ul>
<li>Legacy

<ul>
<li>Boot Parameters:

<ul>
<li><code>rescue</code></li>
<li><code>emergency</code></li>
</ul></li>
</ul></li>
<li>Systemd

<ul>
<li>Boot Parameters:

<ul>
<li><code>systemd.unit=rescue.target</code></li>
<li><code>systemd.unit=emergency.target</code></li>
</ul></li>
</ul></li>
<li>Installation program&rsquo;s (Anaconda) rescue mode

<ul>
<li>Requires install media</li>
<li>Boot Parameters:

<ul>
<li><code>inst.rescue</code></li>
</ul></li>
</ul></li>
</ul>

<h3 id="rescue">rescue</h3>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-services-with-systemd_configuring-basic-system-settings#sect-Managing_Services_with_systemd-Targets-Rescue">RHEL 8 &gt; Configuring basic system settings &gt; Chapter 3. Managing services with systemd &gt; Chapter 3. Managing services with systemd &gt; 3.3. Working with systemd targets &gt; 3.3.5. Changing to rescue mode</a></p>

<p>Rescue mode provides a convenient single-user environment and allows you to repair your system in situations when it is unable to complete a regular booting process. In rescue mode, the system attempts to mount all local file systems and start some important system services, but it does not activate network interfaces or allow more users to be logged into the system at the same time.</p>

<p><em><strong>Note:</strong> Equivalent to the old single user mode, where some services are started and every disk is mounted.</em></p>

<p><strong>Boot Parameter:</strong></p>

<ul>
<li>Legacy: <code>rescue</code></li>
<li>Systemd: <code>systemd.unit=rescue.target</code></li>
</ul>

<p><strong>Summary:</strong></p>

<ul>
<li>Requires root password to enter this mode</li>
<li>Mounts all local filesystems (RW)</li>
<li>No network</li>
<li>Starts important services<br /></li>
<li>Single-user mode</li>
</ul>

<h4 id="instructions">Instructions</h4>

<p>a. At boot, hit <code>e</code> to edit the boot parameters</p>

<p>b. Add one of the boot parameters at the end of the line that starts with linux</p>

<p>c. Press &lsquo;Ctrl + x&rsquo; to start</p>

<h3 id="emergency">emergency</h3>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-services-with-systemd_configuring-basic-system-settings#sect-Managing_Services_with_systemd-Targets-Emergency">RHEL 8 &gt; Configuring basic system settings &gt; Chapter 3. Managing services with systemd &gt; Chapter 3. Managing services with systemd &gt; 3.3. Working with systemd targets &gt; 3.3.6. Changing to emergency mode</a></p>

<p>Emergency mode provides the most minimal environment possible and allows you to repair your system even in situations when the system is unable to enter rescue mode. In emergency mode, the system mounts the root file system in read only mode, does not attempt to mount any other local file systems, does not activate network interfaces, and only starts a few essential services.</p>

<p><strong>Boot Parameter:</strong></p>

<ul>
<li>Legacy: <code>emergency</code></li>
<li>Systemd: <code>systemd.unit=emergency.target</code></li>
</ul>

<p><strong>Summary:</strong></p>

<ul>
<li>Requires root password to enter this mode</li>
<li>Mounts the root filesystem only (RO)</li>
<li>No network</li>
<li>Only essential services are started</li>
<li>The system does not load any init scripts</li>
<li>Multi-user mode</li>
</ul>

<h4 id="instructions-1">Instructions</h4>

<p>a. At boot, hit <code>e</code> to edit the boot parameters</p>

<p>b. Add one of the boot parameters at the end of the line that starts with linux</p>

<p>c. Press &lsquo;Ctrl + x&rsquo; to start</p>

<h3 id="rd-break">rd.break</h3>

<p>Breaks to an interactive shell while in the &lsquo;initrd&rsquo; allowing interaction before the system disk is mounted. The main &lsquo;/&rsquo; is available under &lsquo;/sysroot&rsquo;. Useful if you forgot root&rsquo;s password.</p>

<p><strong>Boot Parameter:</strong></p>

<ul>
<li><code>rd.break</code></li>
</ul>

<h4 id="instructions-2">Instructions</h4>

<p>a. At boot, hit <code>e</code> to edit the boot parameters</p>

<p>b. Add <code>rd.break</code> option at the end of the line that starts with linux</p>

<p>c. Press &lsquo;Ctrl + x&rsquo; to start</p>

<h3 id="anaconda-rescue">Anaconda rescue</h3>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/installer-troubleshooting_installing-rhel#using-rescue-mode_troubleshooting-after-installation">RHEL 8 &gt; Performing a standard RHEL installation &gt; Appendix A. Troubleshooting &gt; A.3.8. Using rescue mode</a></p>

<p>The installation program’s rescue mode is a minimal Linux environment that can be booted from the Red Hat Enterprise Linux DVD or other boot media. It contains command-line utilities for repairing a wide variety of issues. Rescue mode can be accessed from the Troubleshooting menu of the boot menu. In this mode, you can mount file systems as read-only, blacklist or add a driver provided on a driver disc, install or upgrade system packages, or manage partitions.</p>

<h4 id="instructions-3">Instructions</h4>

<p>a. Boot the system from either minimal boot media, or a full installation DVD or USB drive, and wait for the boot menu to be displayed.</p>

<p>b. From the boot menu, either select Troubleshooting &gt; Rescue a Red Hat Enterprise Linux system option, or append the <code>inst.rescue</code> option to the boot command line. To enter the boot command line, press the Tab key on BIOS-based systems or the <code>e</code> key on UEFI-based systems.</p>

<h2 id="password-reset">Password Reset</h2>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/changing-and-resetting-the-root-password-from-the-command-line_configuring-basic-system-settings#resetting-the-forgotten-root-password-on-boot_changing-and-resetting-the-root-password-from-the-command-line">RHEL 8 &gt; Configuring basic system settings &gt; Chapter 9. Changing and resetting the root password &gt; 9.3. Resetting the forgotten root password on boot</a></p>

<p>I will now cover different methods on how to change the root password if you forgot it. This is a common question for the RHCSA exams (or so I&rsquo;ve heard as I have yet to take mine).</p>

<h3 id="method-1-fixing-selinux-context-before-reboot">Method 1: Fixing SELinux context before reboot</h3>

<p>This is not the &laquo;official&raquo; method, but it&rsquo;s the one I like the most. It saves a bit of time from having to relabel the whole system for SELinux context.</p>

<p>a. Boot into <code>rd.break</code> mode</p>

<p>b. Re-mount sysroot in RW</p>

<pre><code class="language-none">switch_root:/# mount -o rw,remount /sysroot
</code></pre>

<p>c. Chroot into sysroot</p>

<pre><code class="language-none">switch_root:/# chroot /sysroot
</code></pre>

<p>d. Change the password for root</p>

<pre><code class="language-none">sh-4.4# passwd
</code></pre>

<p>e. Load the SELinux policies</p>

<pre><code class="language-none">sh-4.4# load_policy -i
</code></pre>

<p>f. Fix the policy for <code>/etc/shadow</code></p>

<pre><code class="language-none">sh-4.4# restorecon -v /etc/shadow
</code></pre>

<p>g. Exit chroot</p>

<pre><code class="language-none">sh-4.4# exit
</code></pre>

<p>h. Remount as RO</p>

<pre><code class="language-none">switch_root:/# mount -o ro,remount /sysroot
</code></pre>

<p>i. Reboot</p>

<pre><code class="language-none">switch_root:/# reboot
</code></pre>

<h3 id="method-2-setting-autorelabel-on-reboot">Method 2: Setting autorelabel on reboot</h3>

<p>This is the most common method that you will find online for the RHCSA exam. It&rsquo;s also the method shown in Red Hat&rsquo;s <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/changing-and-resetting-the-root-password-from-the-command-line_configuring-basic-system-settings#resetting-the-forgotten-root-password-on-boot_changing-and-resetting-the-root-password-from-the-command-line">official documentation for RHEL 8</a>.</p>

<p>a. Boot into <code>rd.break</code> mode</p>

<p>b. Re-mount sysroot in RW</p>

<pre><code class="language-none">switch_root:/# mount -o rw,remount /sysroot
</code></pre>

<p>c. Chroot into sysroot</p>

<pre><code class="language-none">switch_root:/# chroot /sysroot
</code></pre>

<p>d. Change the password for root</p>

<pre><code class="language-none">sh-4.4# passwd
</code></pre>

<p>e. Force the relabel of SELinux context for the filesystem</p>

<pre><code class="language-none">sh-4.4# touch /.autorelabel
</code></pre>

<p>f. Exit chroot</p>

<pre><code class="language-none">sh-4.4# exit
</code></pre>

<p>g. Remount as RO</p>

<pre><code class="language-none">switch_root:/# mount -o ro,remount /sysroot
</code></pre>

<p>h. Reboot</p>

<pre><code class="language-none">switch_root:/# reboot
</code></pre>

<p><em><strong>Note:</strong> It takes a while for the system to relabel all the files with SELinux context.</em></p>

<h3 id="method-3-setting-selinux-to-permissive-and-manually-fixing-the-context">Method 3: Setting SELinux to permissive and manually fixing the context</h3>

<p><em><strong>Links:</strong></em> <a href="https://learn.redhat.com/t5/Platform-Linux/Crack-root-password/td-p/4161/page/2">Red Hat Learning Community</a> - <a href="https://docs.fedoraproject.org/en-US/Fedora/26/html/System_Administrators_Guide/sec-Changing_and_Resetting_the_Root_Password.html">Fedora Documentation</a></p>

<p>With this method we temporarily set SELinux to permissive mode, make our password changes, reload the SELinux context for the shadow file, and then re-enable SELinux.</p>

<p><strong>⚠️ WARNING:</strong> <em>While this initially worked for me on RHEL 8 (you will get a lot of SELinux errors, which is expected), after a while my VM would hang and I could no longer login as any user or restart it.</em></p>

<p>a. Boot into <code>rd.break</code> mode by adding <code>rd.break enforcing=0</code> to the boot line</p>

<p>b. Re-mount sysroot in RW</p>

<pre><code class="language-none">switch_root:/# mount -o rw,remount /sysroot
</code></pre>

<p>c. Chroot into sysroot</p>

<pre><code class="language-none">switch_root:/# chroot /sysroot
</code></pre>

<p>d. Change the password for root</p>

<pre><code class="language-none">sh-4.4# passwd
</code></pre>

<p>e. Exit chroot</p>

<pre><code class="language-none">sh-4.4# exit
</code></pre>

<p>f. Remount as RO</p>

<pre><code class="language-none">switch_root:/# mount -o ro,remount /sysroot
</code></pre>

<p>g. Exit switch_root and wait for the system to finish booting</p>

<pre><code class="language-none">switch_root:/# exit
</code></pre>

<p>h. As root, fix SELinux context for <code>/etc/shadow</code></p>

<pre><code class="language-none">[root@localhost ~]# restorecon -v /etc/shadow
</code></pre>

<p>i. Set SELinux to enforcing mode</p>

<pre><code class="language-none">[root@localhost ~]# setenforce 1
</code></pre>

<h3 id="method-4-disabling-selinux-and-manually-fixing-the-context">Method 4: Disabling SELinux and manually fixing the context</h3>

<p>This is very similar to method 3, however we are completely disabling SELinux.</p>

<p><strong>⚠️ WARNING:</strong> <em>This method did not work for me. My VM did not finish booting after making the changes.</em></p>

<p>a. Boot into <code>rd.break</code> mode by adding <code>rd.break selinux=0</code> to the boot line</p>

<p>b. Re-mount sysroot in RW</p>

<pre><code class="language-none">switch_root:/# mount -o rw,remount /sysroot
</code></pre>

<p>c. Chroot into sysroot</p>

<pre><code class="language-none">switch_root:/# chroot /sysroot
</code></pre>

<p>d. Change the password for root</p>

<pre><code class="language-none">sh-4.4# passwd
</code></pre>

<p>e. Exit chroot</p>

<pre><code class="language-none">sh-4.4# exit
</code></pre>

<p>f. Remount as RO</p>

<pre><code class="language-none">switch_root:/# mount -o ro,remount /sysroot
</code></pre>

<p>g. Exit switch_root and wait for the system to finish booting</p>

<pre><code class="language-none">switch_root:/# exit
</code></pre>

<p>h. As root, fix SELinux context for <code>/etc/shadow</code></p>

<pre><code class="language-none">[root@localhost ~]# restorecon -v /etc/shadow
</code></pre>

<p>i. Re-enable SELinux</p>

<pre><code class="language-none">[root@localhost ~]# setenforce 1
</code></pre>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>I hope I helped you make a bit more sense from all of the different options and info around this topic. If you have any comments, corrections or addition, please leave them below. I would love to hear from you.</p>

</div>


          <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f14%2frhcsa8-boot-targets-system-targets-and-root-password-reset%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=RHCSA%20v8%3a%20Boot%20Targets%2c%20Systemd%20Targets%20and%20root%20Password%20Reset&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f14%2frhcsa8-boot-targets-system-targets-and-root-password-reset%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f14%2frhcsa8-boot-targets-system-targets-and-root-password-reset%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f14%2frhcsa8-boot-targets-system-targets-and-root-password-reset%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f14%2frhcsa8-boot-targets-system-targets-and-root-password-reset%2f&amp;title=RHCSA%20v8%3a%20Boot%20Targets%2c%20Systemd%20Targets%20and%20root%20Password%20Reset" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=RHCSA%20v8%3a%20Boot%20Targets%2c%20Systemd%20Targets%20and%20root%20Password%20Reset&amp;body=Check out this site https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f14%2frhcsa8-boot-targets-system-targets-and-root-password-reset%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://blog.victormendonca.com/2020/11/03/zfs-for-dummies/" title="ZFS for Dummies">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://blog.victormendonca.com/2020/11/18/linux-logical-volume-manager/" title="RHCSA v8: Linux Logical Volume Manager">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//victorbrca-github-io.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

        
          <div>
  <h2><a href="https://blog.victormendonca.com/2020/11/03/zfs-for-dummies/">ZFS for Dummies</a>
</h2>

  <div class="margin-10">
    <small>
  <i class="fa fa-calendar"></i>
  <time datetime="2020-11-03">3 Nov, 2020</time>
</small>

    
  <i class="fa fa-tags"></i>
  
  <a href="https://blog.victormendonca.com/tags/zfs" class="label label-primary">ZFS</a>
  
  <a href="https://blog.victormendonca.com/tags/freebsd" class="label label-primary">FreeBSD</a>
  
  <a href="https://blog.victormendonca.com/tags/linux" class="label label-primary">Linux</a>
  


  </div>
</div>

          <div class="content">
  

<p>As mentioned on previous posts, I have spent the past few weeks dealing with a ZFS crash on my FreeNAS install. Because of that, not only was I forced to learn how to troubleshoot ZFS, but I also had to learn how to setup new volumes and come up with new backup strategies (between a few other things).</p>

<p>This was a great opportunity for me to learn more about ZFS (because I new &lsquo;nada&rsquo; to start with). And I&rsquo;m happy to share some of the knowledge that I gathered with you on this post.</p>

<p>Please keep in mind that I don&rsquo;t consider myself an expert on ZFS (not even close), but I will try to make things simple and easy to understand for someone, who like me, is just getting started with ZFS.</p>

<h1 id="about-zfs">About ZFS</h1>

<h4 id="what-is-zfs-and-it-s-history">What is ZFS and It&rsquo;s History</h4>

<p>ZFS is a local filesystem (i.e.: ext4, NTFS, exfat) and logical volume manager (i.e.: LVM on Linux) created by Sun Microsystems. ZFS was published under an open source license until Oracle bought Sun Microsystems and closed source the license. Because the source code was already in the open and ported to different OSs, eventually a project called &lsquo;OpenZFS&rsquo; was created, and that is the core code that is used on most Unix like systems today (Linux, FreeBSD, etc.).</p>

<h3 id="zfs-components">ZFS Components</h3>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/zfs -components.png" alt="" /></p>

<h4 id="vdev">vdev</h4>

<p>A vdev is composed of one or more physical drives (can also be of things other than hard drive, like files). They can be combined together in mirrors or RAIDZs.</p>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/vdev.png" alt="" /></p>

<p>💡 <em><strong>TIP:</strong> There are 7 different types of vdevs, and some of them (like host spare, L2ARC and ZIL) are very important.</em></p>

<h4 id="pool">Pool</h4>

<p>A pool is composed of one or more vdevs and they usually contain a volume or a dataset (which you create after creating the pool). You create/define your vdevs when you create a pool (with the <code>zpool</code> command which we&rsquo;ll see later). This allows you to mix vdev types together to achieve other RAIDZ levels (see example below):</p>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/raid10.png" alt="" /></p>

<h4 id="datasets">Datasets</h4>

<p>Dataset is the filesystem part of ZFS (so far we&rsquo;ve seen the LVM components). Here you can define user access, quotas, compression, snapshots, etc&hellip;</p>

<h4 id="volume">Volume</h4>

<p>Volume is the brother of datasets but in a block device representation. It provides some of the features that datasets have, but not all. Volumes can be useful to run other filesystems on top of ZFS, or to export iSCSI extents.</p>

<h3 id="raidz-types">RAIDZ Types</h3>

<ul>
<li>Dynamic/Simple Stripe (RAID0) - Distributes data without parity. Loosing a device means loosing all data</li>
<li>MIRROR (RAID1) - Mirrored drives. Used with 2 to 4 disks (or more)</li>
<li>RAIDZ-1 (RAID5) - Distributes parity along with the data and can lose one physical drive before a raid failure. RAIDZ requires at least 3 disks</li>
<li>RAIDZ-2 (RAID6) - Distributes parity along with the data and can lose up to 2 physical drives. RAIDZ-2 requires at least 4 disks</li>
<li>RAIDZ-3 - Distributes parity along with the data and can lose up to 3 physical drives. RAIDZ-3 requires at least 4, but should be used with no less than 5 disks</li>
</ul>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/raidz-comparisson.png" alt="" /></p>

<hr />

<h1 id="commands">Commands</h1>

<p>Let&rsquo;s take a look at the most common commands for handling ZFS pools and filesystem. We&rsquo;ll use <code>/dev/sdx</code> to refer to device names, but keep in mind that using the device UUID is preferred in order to avoid boot issues due to device name changes.</p>

<h3 id="1-zfs-pool-commands">1.ZFS Pool Commands</h3>

<p>These are the commands related to creating vdevs and pools. We will be looking at:</p>

<ul>
<li><code>zpool create</code> - Create a pool (and vdevs)</li>
<li><code>zpool status</code> - Displays pool status</li>
<li><code>zpool list</code> - List pool and it&rsquo;s details</li>
<li><code>zpool history</code> - Shows history of commands for zpool</li>
<li><code>zpool import</code>- Imports and mounts pool</li>
<li><code>zpool export</code> - Exports and unmounts pool</li>
<li><code>zpool destroy</code> - Destroy pool and all filesystems</li>
<li><code>zpool scrub</code> - Starts scrub of pool</li>
</ul>

<h4 id="1-1-creating-a-pool-and-vdevs">1.1.Creating a Pool (and vdevs)</h4>

<p>To create a new pool we use the <code>zpool create</code> command. We specify the pool name and the device we want to use.</p>

<p>It&rsquo;s basic usage is:</p>

<pre><code class="language-none"># zpool create [pool] [devices]
</code></pre>

<p>Now let&rsquo;s look at different examples for this command.</p>

<h5 id="create-a-pool-on-a-single-disk"><strong>Create a pool on a single disk</strong></h5>

<p>The command below creates a pool on a single disk.</p>

<pre><code class="language-none"># zpool create tank /dev/sdb  
</code></pre>

<h5 id="create-a-dynamic-stripe-pool-on-3-disks"><strong>Create a dynamic stripe pool on 3 disks</strong></h5>

<p>Remember that dynamic stripe is the same as RAID0 and that it has no parity.</p>

<pre><code class="language-none"># zpool create tank /dev/sdb /dev/sdc /dev/sdd
</code></pre>

<p>We can view the new pool with <code>zpool status</code></p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool status
  pool: tank
 state: ONLINE
  scan: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  sdb       ONLINE       0     0     0
	  sdc       ONLINE       0     0     0
	  sdd       ONLINE       0     0     0

errors: No known data errors
</code></pre>

<p>Note that the pool name is &lsquo;tank&rsquo; and the vdevs are &lsquo;sdb&rsquo;, &lsquo;sdc&rsquo; and &lsquo;sdd&rsquo;</p>

<h5 id="create-a-mirrorred-pool-on-2-disks"><strong>Create a mirrorred pool on 2 disks</strong></h5>

<pre><code class="language-none"># zpool create tank mirror sdb sdc
</code></pre>

<p>Note that I can omit <code>/dev</code> and give the device name. Let&rsquo;s view the result.</p>

<pre><code class="language-none"># zpool status
  pool: tank
 state: ONLINE
  scan: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  mirror-0  ONLINE       0     0     0
	    sdb     ONLINE       0     0     0
	    sdc     ONLINE       0     0     0

errors: No known data errors
</code></pre>

<p>Our vdev is &lsquo;mirror-0&rsquo; and our pool is tank.</p>

<h5 id="create-a-raid-z-pool"><strong>Create a RAID-Z pool</strong></h5>

<pre><code class="language-none"># zpool create tank raidz sdb sdc sdd
</code></pre>

<p>And the result indicating that my vdev is RAIDZ1.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool status
  pool: tank
 state: ONLINE
  scan: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  raidz1-0  ONLINE       0     0     0
	    sdb     ONLINE       0     0     0
	    sdc     ONLINE       0     0     0
	    sdd     ONLINE       0     0     0

errors: No known data errors
</code></pre>

<p>You can use the same command to create RAIDZ2,3 pools.</p>

<pre><code class="language-none"># zpool create [pool name] raidz[1,2,3] [devices]
</code></pre>

<h5 id="specifying-a-default-mount-point-for-the-pool"><strong>Specifying a default mount point for the pool</strong></h5>

<p>You can also specify the default mount point for the pool by using the <code>-m</code> flag as you create it.</p>

<pre><code class="language-none"># zpool create tank -m /mnt/tank mirror sdb sdc
</code></pre>

<p>We can see that our new pool was created and mounted at <code>/mnt/tank</code></p>

<pre><code class="language-none"># zfs list
NAME   USED  AVAIL     REFER  MOUNTPOINT
tank    99K  4.36G       24K  /mnt/tank
</code></pre>

<p>💡 <em><strong>TIP:</strong> Also read up on the <code>zpool add</code> command.</em></p>

<h4 id="1-2-getting-pool-status">1.2.Getting Pool Status</h4>

<p>After we create a new pool it&rsquo;s automatically imported into our system. As we have seen before, we can view details of the pool with the <code>zpool status</code> command.</p>

<pre><code class="language-none"># zpool status tank
  pool: tank
 state: ONLINE
  scan: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  mirror-0  ONLINE       0     0     0
	    sdb     ONLINE       0     0     0
	    sdc     ONLINE       0     0     0

errors: No known data errors
</code></pre>

<p>Some of the fields we did not look before are:</p>

<ul>
<li><code>state:</code> Indicates if pool is online or not</li>
<li><code>status:</code> Additional information about the pool</li>
<li><code>action:</code> Indicates if there are any pending actions for the pool</li>
<li><code>scan:</code> If a scrub is in progress or the last scrub run status</li>
<li><code>errors:</code> Indicates if there are any problems with the pool</li>
</ul>

<p>For example:</p>

<pre><code class="language-none"># zpool status tank
  pool: tank
 state: ONLINE
status: Some supported features are not enabled on the pool. The pool can
        still be used, but some features are unavailable.
action: Enable all features using 'zpool upgrade'. Once this is done,
        the pool may no longer be accessible by software that does not support
        the features. See zpool-features(7) for details.
  scan: scrub repaired 0 in 0 days 03:37:12 with 0 errors on Wed Oct 28 03:37:13 2020
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  mirror-0  ONLINE       0     0     0
	    sdb     ONLINE       0     0     0
	    sdc     ONLINE       0     0     0

errors: No known data errors
</code></pre>

<p>Another example:</p>

<pre><code class="language-none"># zpool status -v tank
  pool: tank
 state: ONLINE
status: One or more devices has experienced an error resulting in data
    corruption.  Applications may be affected.
action: Restore the file in question if possible.  Otherwise restore the
    entire pool from backup.
   see: http://illumos.org/msg/ZFS-8000-8A
  scan: scrub repaired 0 in 0 days 04:21:43 with 0 errors on Sun Feb 23 04:21:45 2020
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  mirror-0  ONLINE       0     0     0
	    sdb     ONLINE       0     0     0
	    sdc     ONLINE       0     0     0

errors: Permanent errors have been detected in the following files:

        tank:&lt;0xdcca&gt;
</code></pre>

<h4 id="1-3-listing-pools">1.3.Listing Pools</h4>

<p>As we have seen before, we can view some details of the pool with the <code>zpool status</code> command. But there are other commands, like <code>zpool list</code> that can give us information about the pool.</p>

<pre><code class="language-none"># zpool list {pool name}
</code></pre>

<p>On the example below, we look at the details for our mirrored tank pool:</p>

<pre><code class="language-none"># zpool list
NAME   SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
tank  4.50G   117K  4.50G        -         -     0%     0%  1.00x    ONLINE  -
</code></pre>

<h4 id="1-4-show-pool-history">1.4.Show Pool History</h4>

<p>This is another useful command that displays the history of commands that were executed against a pool from it&rsquo;s creation (of course only commands that make changes to the pool&rsquo;s configuration).</p>

<pre><code class="language-none"># zpool history tank
History for 'tank':
2020-11-02.15:02:53 zpool create tank -m /mnt/tank mirror sdb sdc
2020-11-02.15:50:43 zpool scrub tank
2020-11-02.15:53:30 zfs set compression=lz4 tank
2020-11-02.15:54:03 zpool scrub tank
</code></pre>

<h4 id="1-5-importing-pools">1.5.Importing Pools</h4>

<p>Usually after creating a pool it&rsquo;s set to import and mount automatically, but you may encounter scenarios where you need to manually import a pool (like when troubleshooting or after re-imaging a system).</p>

<p>Note that the import command will also mount the pool.</p>

<h5 id="lists-pools-available-to-import"><strong>Lists pools available to import</strong></h5>

<p>Running the <code>zpool import</code> command without a pool name will show you a list of pools that can be imported.</p>

<p>Example of when no pools are available to be imported.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool import
no pools available to import
</code></pre>

<p>Here we have a pool that can be imported.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool import
   pool: tank
     id: 2008489828128587072
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

	tank        ONLINE
	  mirror-0  ONLINE
	    sdb     ONLINE
	    sdc     ONLINE
</code></pre>

<h5 id="importing-the-pool"><strong>Importing the pool</strong></h5>

<p>Give the command a pool name and it will be imported.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool import tank

root@ubuntu-vm:~# zpool list
NAME   SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
tank  4.50G   147K  4.50G        -         -     0%     0%  1.00x    ONLINE  -
</code></pre>

<p>You can also import all available pools by using the <code>-a</code> option.</p>

<pre><code class="language-none"># zpool import -a
</code></pre>

<h5 id="importing-a-pool-with-an-alternate-root-location"><strong>Importing a Pool with an Alternate Root Location</strong></h5>

<p>Use the <code>-R</code> flag to mount the pool to an alternate root location. Note that this is not the mount path for the pool, but an alternate root folder.</p>

<p><em><code>tank</code> is by default configured to be mounted at <code>/mnt/tank</code></em></p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool import -R /mnt/tank2 tank

root@ubuntu-vm:~# zfs list
NAME   USED  AVAIL     REFER  MOUNTPOINT
tank   117K  4.36G       24K  /mnt/tank2/mnt/tank
</code></pre>

<h4 id="1-6-exporting-the-pool">1.6.Exporting the Pool</h4>

<p>As expected, this is the opposite of the import command. The export command attempts to unmount any mounted file systems within the pool before continuing.</p>

<pre><code class="language-none"># zpool export [pool name]
</code></pre>

<p>For example:</p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool export tank

root@ubuntu-vm:~# zpool list
no pools available
</code></pre>

<p>If any of the file systems fail to unmount you can forcefully unmount them by using the <code>-f</code> option. However, if ZFS volumes exist and are in use, even with <code>-f</code> it will fail to export.</p>

<h4 id="1-7-destroying-deleting-pools">1.7.Destroying/Deleting Pools</h4>

<p>We can use the <code>zfs destroy</code> command to delete pools and all it&rsquo;s child datasets and/or volumes.</p>

<p>⚠️ <strong>WARNING:</strong> <em>This will delete all your data, including any snapshots your may have.</em></p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool destroy tank

root@ubuntu-vm:~# zpool list
no pools available

root@ubuntu-vm:~# zpool import
no pools available to import
</code></pre>

<h4 id="1-8-scrubbing-pools">1.8.Scrubbing Pools</h4>

<p>ZFS scrub checks every block in a pool against its known checksum to make sure that the data is valid. If you have vdevs with parity, ZFS scrub will also repair the data using healthy data from other disks. Scrubs should run on a schedule to make sure your systems stays healthy.</p>

<h5 id="initiating-a-scrub"><strong>Initiating a scrub</strong></h5>

<p>Initiating a scrub of a pool is as simple as running:</p>

<pre><code class="language-none"># zpool scrub [pool]
</code></pre>

<h5 id="checking-the-status-of-a-scrub"><strong>Checking the status of a scrub</strong></h5>

<p>You can check the status of a scrub with <code>zpool status</code> and looking for messages in the &lsquo;scan&rsquo; section.</p>

<pre><code class="language-none">root@ubuntu-vm:/mnt/tank# zpool status tank
  pool: tank
 state: ONLINE
  scan: scrub repaired 0B in 0 days 00:00:03 with 0 errors on Tue Nov  3 16:26:23 2020
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  mirror-0  ONLINE       0     0     0
	    sdb     ONLINE       0     0     0
	    sdc     ONLINE       0     0     0

errors: No known data errors
</code></pre>

<h5 id="stopping-a-scrub"><strong>Stopping a scrub</strong></h5>

<p>Use the <code>-s</code> flag.</p>

<pre><code class="language-none"># zpool scrub -s [pool]
</code></pre>

<h3 id="2-zfs-filesystem-commands">2.ZFS Filesystem Commands</h3>

<p>Now we will look at the commands that will help us work with filesystems (datasets) and volumes. We will concentrate more on the filesystem side of things and will not cover volumes.</p>

<p>The commands we will review are:</p>

<ul>
<li><code>zfs create</code> - Creates a new volume or filesystem</li>
<li><code>zfs mount/umount</code> - Mounts the filesystem</li>
<li><code>zfs list</code> - Lists datasets and snapshots</li>
<li><code>zfs get/set</code> - Gets configuration and sets configuration for the dataset</li>
<li><code>zfs snapshot</code> - Handles snapshots</li>
<li><code>zfs diff</code> - Used to compare data between snapshot</li>
<li><code>zfs rollback</code> - Rolls back a snapshot</li>
<li><code>zfs send/recv</code> - Sends a snapshot as a stream of data</li>
<li><code>zfs destroy</code> - Deletes datasets and snapshots</li>
</ul>

<h4 id="2-1-creating-datasets">2.1. Creating Datasets</h4>

<p>We can create datasets with the <code>zfs create</code> command. Here we create &lsquo;dataset1&rsquo; as child of the &lsquo;tank&rsquo; dataset (that was created automatically with the <code>zpool create</code> command).</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs create tank/dataset1

root@ubuntu-vm:~# zfs list
NAME            USED  AVAIL     REFER  MOUNTPOINT
tank            145K  9.36G     30.6K  /tank
tank/dataset1  30.6K  9.36G     30.6K  /tank/dataset1
</code></pre>

<h5 id="creating-missing-parent-datasets"><strong>Creating missing parent datasets</strong></h5>

<p>We can also create missing parent datasets with the <code>-p</code> flag (similar to <code>mkdir -p</code>).</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs create tank/dataset1/childset1/childset2
cannot create 'tank/dataset1/childset1/childset2': parent does not exist

root@ubuntu-vm:~# zfs create -p tank/dataset1/childset1/childset2

root@ubuntu-vm:~# zfs list
NAME                                USED  AVAIL     REFER  MOUNTPOINT
tank                                249K  9.36G     30.6K  /tank
tank/dataset1                      30.6K  9.36G     30.6K  /tank/dataset1
tank/dataset1/childset1            61.3K  9.36G     30.6K  /tank/dataset1/childset1
tank/dataset1/childset1/childset2  30.6K  9.36G     30.6K  /tank/dataset1/childset1/childset2
</code></pre>

<h4 id="2-2-mounting-filesystems-datasets">2.2. Mounting Filesystems (Datasets)</h4>

<p>We can use the <code>zfs mount/unmount</code> commands to view the current mount points as well as mounting/unmounting filesystems.</p>

<h5 id="viewing-current-mounted-filesystems"><strong>Viewing current mounted filesystems</strong></h5>

<p>Without any arguments, <code>zfs mount</code> will display all mounted zfs filesystems and their respective mount points (without the child datasets).</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs mount
tank                            /tank
</code></pre>

<h5 id="mounting-filesystems"><strong>Mounting filesystems</strong></h5>

<p>Use <code>zfs mount [pool|dataset]</code> to mount filesystems. On the example below we use <code>zfs mount</code> to establish that no datasets are mounted, and then we mount the &lsquo;tank&rsquo; dataset and confirm that is mounted with <code>zfs mount</code>.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs mount

root@ubuntu-vm:~# zfs mount tank

root@ubuntu-vm:~# zfs mount
tank                            /tank
</code></pre>

<p>Use the <code>-a</code> option to mount all filesystems.</p>

<h5 id="mount-a-child-dataset"><strong>Mount a child dataset</strong></h5>

<p>You can also mount a child dataset without the parent datasets. For example, here we confirm that &lsquo;tank&rsquo; is not mounted, then we look at the available datasets, and we execute the command to mount the <code>tank/dataset2/childset2</code> dataset only.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs mount

root@ubuntu-vm:~# zfs list
NAME                                USED  AVAIL     REFER  MOUNTPOINT
tank                                249K  9.36G     30.6K  /tank
tank/dataset1                      30.6K  9.36G     30.6K  /tank/dataset1
tank/dataset2                      91.9K  9.36G     30.6K  /tank/dataset2
tank/dataset2/childset2            61.3K  9.36G     30.6K  /tank/dataset2/childset2
tank/dataset2/childset2/childset2  30.6K  9.36G     30.6K  /tank/dataset2/childset2/childset2

root@ubuntu-vm:~# zfs mount tank/dataset2/childset2

root@ubuntu-vm:~# zfs mount
tank/dataset2/childset2         /tank/dataset2/childset2
</code></pre>

<p>Note that this will create the required path in the OS filesystem to mount the child dataset. If you decide to mount the parent dataset later you may run into a <code>directory is not empty</code> error because of the created directories.</p>

<h5 id="unmounting-filesystems"><strong>Unmounting filesystems</strong></h5>

<p>Run<code>zfs unmount</code> and specify the dataset name.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs mount
tank                            /tank

root@ubuntu-vm:~# zfs unmount tank

root@ubuntu-vm:~# zfs mount

</code></pre>

<h4 id="2-3-listing-filesystems-datasets">2.3. Listing Filesystems (Datasets)</h4>

<p>You can list the dataset by running <code>zfs list [dataset name]</code>.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs list tank
NAME   USED  AVAIL     REFER  MOUNTPOINT
tank   253K  9.36G     30.6K  /tank
</code></pre>

<p>And you can also specify the mount point as an argument.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs list /tank
NAME   USED  AVAIL     REFER  MOUNTPOINT
tank   253K  9.36G     30.6K  /tank
</code></pre>

<p>If run without a dataset name, <code>zfs list</code> will show all datasets in the system recursively.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs list
NAME                                USED  AVAIL     REFER  MOUNTPOINT
tank                                253K  9.36G     30.6K  /tank
tank/dataset1                      30.6K  9.36G     30.6K  /tank/dataset1
tank/dataset2                      91.9K  9.36G     30.6K  /tank/dataset2
tank/dataset2/childset2            61.3K  9.36G     30.6K  /tank/dataset2/childset2
tank/dataset2/childset2/childset2  30.6K  9.36G     30.6K  /tank/dataset2/childset2/childset2
</code></pre>

<p>💡 <em><strong>TIP:</strong> when specifying a dataset name you can also use the <code>-r</code> flag to display the dataset recursively.</em></p>

<h4 id="2-4-getting-and-setting-dataset-properties">2.4. Getting and Setting Dataset Properties</h4>

<p>Properties control the behavior of filesystems, volumes, snapshots, and clones. ZFS properties can look similar to mount options.</p>

<h5 id="getting-a-list-of-all-the-properties-for-a-dataset"><strong>Getting a list of all the properties for a dataset</strong></h5>

<pre><code class="language-none"># zfs get all [dataset]
</code></pre>

<h5 id="getting-the-current-value-for-a-specific-property"><strong>Getting the current value for a specific property</strong></h5>

<pre><code class="language-none">root@ubuntu-vm:~# zfs get compression tank
NAME  PROPERTY     VALUE     SOURCE
tank  compression  off       default
</code></pre>

<h5 id="setting-a-property-value"><strong>Setting a property value</strong></h5>

<p>Use the <code>zfs set</code> command.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs set compression=lz4 tank

root@ubuntu-vm:~# zfs get compression tank
NAME  PROPERTY     VALUE     SOURCE
tank  compression  lz4       local
</code></pre>

<h4 id="2-5-creating-snapshots">2.5. Creating Snapshots</h4>

<p>Snapshots allow you to save the state of a filesystem to a current point in time, without duplicating storage (files are not copied). It flags existing data as &laquo;read-only&raquo; while allowing new data to be added to the filesystem without affecting the existing data blocks that are protected by the snapshot (the whole process is a bit more complicated than this).</p>

<p>Let&rsquo;s take a look at the image below as an example. You have a filesystem with existing data (Data A) and you take a snapshot (snapshot 1). Then you make some changes, add new files (Data B) and take another snapshot (snapthot 2). After that you make even more changes (Data C).</p>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/snapshot.1.png" alt="" /></p>

<p>Snapshot 1 protects the original data (Data A), while snapshot 2 protects Data Changes (B) as well as the original data (Data A). So you can delete snapshot 1 and data (A) will still be protected.</p>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/snapshot.2.png" alt="" /></p>

<p><em><strong>Note:</strong> The amount of data used for the snapshots is very small because we are not copying the files, but instead the filesystem top-level metadata block indicating the they belong to a snapshot.</em></p>

<p>And here are a few scenarios of what happens when you delete files and snapshots:</p>

<p><img src="https://blog.victormendonca.com/img/zfs-cheat-sheet-for-dummies/snapshot.3.png" alt="" /></p>

<p>Snapshots are great for testing software development, or creating a failsafe before an upgrade. But by no means they should be considered (by itself) as a backup or DR solution.</p>

<h5 id="creating-a-snapshot"><strong>Creating a snapshot</strong></h5>

<pre><code class="language-none">zfs snapshot create [pool/dataset@snapshot_name]
</code></pre>

<p>For example:</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs snapshot tank/dataset1@snapshot1

root@ubuntu-vm:~# zfs list -t snapshot
NAME                   USED  AVAIL     REFER  MOUNTPOINT
tank/dataset1@snapshot1  17.3K      -     3.00G  -
</code></pre>

<h5 id="creating-recursive-snapshots"><strong>Creating recursive snapshots</strong></h5>

<p>If you have multiple child datasets, you can either create one snapshot of the top-level dataset (usually the pool name), or use the <code>-r</code> flag to create snapshots recursively.</p>

<p>Snapshot of the main dataset:</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs snapshot tank@snapshot-master

root@ubuntu-vm:~# zfs list -t snapshot
NAME                   USED  AVAIL     REFER  MOUNTPOINT
tank@snapshot-master     0B      -     30.6K  -
</code></pre>

<p>Recursive snapshot:</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs snapshot -r tank@recursive

root@ubuntu-vm:~# zfs list -t snapshot
NAME                      USED  AVAIL     REFER  MOUNTPOINT
tank@recursive              0B      -     30.6K  -
tank/dataset1@recursive     0B      -     3.00G  -
</code></pre>

<h5 id="listing-snapshots"><strong>Listing snapshots</strong></h5>

<p>Use <code>zfs list -t snapshot</code>.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs list -t snapshot
NAME                      USED  AVAIL     REFER  MOUNTPOINT
tank@recursive              0B      -     30.6K  -
tank/dataset1@recursive     0B      -     3.00G  -
</code></pre>

<h4 id="2-6-comparing-snapshots">2.6. Comparing Snapshots</h4>

<p>You can use <code>zfs diff</code> to compare snapshots.</p>

<pre><code class="language-none"># zfs diff [older snapshot] [newer snapshot]
</code></pre>

<p>For example:</p>

<pre><code class="language-none">root@ubuntu-vm:# zfs diff tank@initial tank@second
+	/mnt/tank/file-1.txt
+	/mnt/tank/file-2.txt
+	/mnt/tank/file-3.txt
M	/mnt/tank/
</code></pre>

<h4 id="2-7-restoring-a-snapshot">2.7. Restoring a Snapshot</h4>

<p>Restore a snapshots with <code>zfs rollback</code>. Note that restoring a snapshot will delete all files that were created after the snapshot (as we saw in our example). It will also delete any newer snapshots (you will be asked to use the <code>-r</code> option to rollback and delete newer snapshots).</p>

<pre><code class="language-none">zfs rollback [pool/dataset@snapshot_name]
</code></pre>

<h4 id="2-9-sending-and-receiving-snapshots">2.9. Sending and Receiving Snapshots</h4>

<p>One of the best features of ZFS is &lsquo;ZFS send&rsquo;. It allows you send snapshots as a stream of data. This is a great way replicate a snapshot and it&rsquo;s dataset to a file, another pool or even to another system via SSH. Amazing no!</p>

<p>Let&rsquo;s look at the example below. We have 2 pools in our system named &lsquo;tank&rsquo; and &lsquo;backup&rsquo;.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zpool list
NAME     SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
tank       9G  1.50G  7.50G        -         -     0%    16%  1.00x    ONLINE  -
backup  4.50G   104K  4.50G        -         -     0%     0%  1.00x    ONLINE  -
</code></pre>

<p>In our tank pool we have a dataset for our Movies.</p>

<pre><code class="language-none">root@ubuntu-vm:/tank/Movies# zfs list -r tank
NAME          USED  AVAIL     REFER  MOUNTPOINT
tank         1.50G  7.22G       24K  /tank
tank/Movies  1.50G  7.22G     1.50G  /tank/Movies
</code></pre>

<p>Before we can send this data we need create a snapshot:</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs snapshot tank/Movies@$(date '+%Y-%m-%d_%H-%M')

root@ubuntu-vm:~# zfs list -t snapshot
NAME                           USED  AVAIL     REFER  MOUNTPOINT
tank/Movies@2020-11-03_15-29     0B      -     1.50G  -
</code></pre>

<p>And now we can send our snapshot to our backup pool with <code>zfs send/recv</code>.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs send tank/Movies@2020-11-03_15-29 | zfs recv backup/Movies
</code></pre>

<p>And let&rsquo;s confirm that it worked.</p>

<pre><code class="language-none">root@ubuntu-vm:~# zfs list
NAME            USED  AVAIL     REFER  MOUNTPOINT
backup         1.50G  2.86G       24K  /backup
backup/Movies  1.50G  2.86G     1.50G  /backup/Movies
tank           1.50G  7.22G       24K  /tank
tank/Movies    1.50G  7.22G     1.50G  /tank/Movies

root@ubuntu-vm:~# zfs list -t snapshot
NAME                             USED  AVAIL     REFER  MOUNTPOINT
backup/Movies@2020-11-03_15-29     0B      -     1.50G  -
tank/Movies@2020-11-03_15-29       0B      -     1.50G  -
</code></pre>

<p>💡 <em><strong>TIP:</strong> It&rsquo;s worth to look into all the options and use cases for ZFS send. Combined with RAIDZs and snapshots, it can help you make your filesystem almost indestructible.</em></p>

<h4 id="2-10-destroying-filesystems-datasets-and-snapshots">2.10. Destroying Filesystems (Datasets) and Snapshots</h4>

<h5 id="destroying-datasets"><strong>Destroying datasets</strong></h5>

<p>To destroy a dataset, use <code>zfs destroy</code> (the <code>-r</code> flag also works here).</p>

<pre><code class="language-none">zfs destroy [pool/dataset]
</code></pre>

<h5 id="destroying-snapshots"><strong>Destroying snapshots</strong></h5>

<p>To destroy a snapshot, also use the <code>zfs destroy</code> command (and the <code>-r</code> flag also works here).</p>

<pre><code class="language-none">zfs destroy [pool/dataset@snapshot_name]
</code></pre>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>While we covered a lot of different topics and commands on ZFS, in reality, we really only scratched the surface on what ZFS can do. If you want to learn more about ZFS I&rsquo;ve added a few links below with some great reading.</p>

<hr />

<p><strong>References and additional reading:</strong></p>

<ul>
<li>FreeBSD Mastery: ZFS - <a href="https://www.goodreads.com/book/show/25595471-freebsd-mastery">https://www.goodreads.com/book/show/25595471-freebsd-mastery</a></li>
<li>Ubuntu Wiki - <a href="https://wiki.ubuntu.com/ZFS">https://wiki.ubuntu.com/ZFS</a></li>
<li>Zpool Administration - <a href="https://pthree.org/2012/04/17/install-zfs-on-debian-gnulinux/">https://pthree.org/2012/04/17/install-zfs-on-debian-gnulinux/</a></li>
<li>ZFS Build - <a href="http://www.zfsbuild.com/">http://www.zfsbuild.com/</a></li>
<li>ZFS Features and Terminology - <a href="https://www.freebsd.org/doc/handbook/zfs-term.html">https://www.freebsd.org/doc/handbook/zfs-term.html</a></li>
<li>Klennet Storage Software - <a href="https://www.klennet.com/zfs-recovery/zfs-basics.aspx">https://www.klennet.com/zfs-recovery/zfs-basics.aspx</a></li>
</ul>

</div>


          <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f03%2fzfs-for-dummies%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=ZFS%20for%20Dummies&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f03%2fzfs-for-dummies%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f03%2fzfs-for-dummies%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f03%2fzfs-for-dummies%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f03%2fzfs-for-dummies%2f&amp;title=ZFS%20for%20Dummies" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=ZFS%20for%20Dummies&amp;body=Check out this site https%3a%2f%2fblog.victormendonca.com%2f2020%2f11%2f03%2fzfs-for-dummies%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://blog.victormendonca.com/2020/10/30/my-grafana-setup/" title="Overview of My Grafana Setup">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://blog.victormendonca.com/2020/11/14/rhcsa8-boot-targets-system-targets-and-root-password-reset/" title="RHCSA v8: Boot Targets, Systemd Targets and root Password Reset">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//victorbrca-github-io.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

        
        
<nav>
  <ul class="pagination">
    


<li  class="disabled" >
  <a aria-label="First" href="https://blog.victormendonca.com//">
    <span aria-hidden="true">&laquo;&laquo;</span>
  </a>
</li>

<li  class="disabled" >
  <a aria-label="Previous" href="#">
    <span aria-hidden="true">&laquo;</span>
    </a>
</li>

<li  class="active" >
  <a href="https://blog.victormendonca.com//">
    1
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/2/">
    2
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/3/">
    3
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/4/">
    4
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/5/">
    5
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/6/">
    6
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/7/">
    7
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/8/">
    8
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/9/">
    9
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/10/">
    10
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/11/">
    11
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/12/">
    12
    </a>
</li>

<li >
  <a href="https://blog.victormendonca.com//page/13/">
    13
    </a>
</li>


<li >
  <a aria-label="Next" href="https://blog.victormendonca.com//page/2/">
    <span aria-hidden="true">&raquo;</span>
    </a>
</li>
<li >
  <a aria-label="Last" href="https://blog.victormendonca.com//page/13/">
    <span aria-hidden="true">&raquo;&raquo;</span>
  </a>
</li>


  </ul>
</nav>


      </div>
      
        <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
          <div>
  

   
    <div class="section">
      <header><div class="title"></div></header>
      <div class="content">
        <img style="float: center; padding-right: 5px;" src="https://blog.victormendonca.com/img/avatar.jpg" hspace="20" width="240"></img>
        <br/>
        <div class="social-icons" style="display:inline-block; text-align: center; width:100%;">
        <a href="https://github.com/victorbrca" target="_blank"><i class="fa fa-github fa-2x" style="padding-right: 5px; padding-left: 5px" aria-hidden="true"></i></a>
        <a href="https://twitter.com/victorbrca" target="_blank"><i class="fa fa-twitter fa-2x" style="padding-right: 5px; padding-left: 1px" aria-hidden="true"></i></a>
        <a href="http://www.linkedin.com/in/victormendonca" target="_blank"><i class="fa fa-linkedin-square fa-2x" style="padding-right: 5px; padding-left: 1px" aria-hidden="true"></i></a>
        <a href="https://www.facebook.com/victormendonca" target="_blank"><i class="fa fa-facebook-official fa-2x" style="padding-right: 5px; padding-left: 1px" aria-hidden="true"></i></a>
        <div>
        <br/>
      </div>
    </div>

    
      
      
      <div class="section taxonomies">
        <header><div class="title"><b>tags</b></div></header>

        <div class="content1">
          <ul>
            <li><a href="https://blog.victormendonca.com/tags/linux">linux</a></li><li><a href="https://blog.victormendonca.com/tags/bash">bash</a></li><li><a href="https://blog.victormendonca.com/tags/hardware">hardware</a></li><li><a href="https://blog.victormendonca.com/tags/redhat">redhat</a></li><li><a href="https://blog.victormendonca.com/tags/rhcsa">rhcsa</a></li><li><a href="https://blog.victormendonca.com/tags/networking">networking</a></li><li><a href="https://blog.victormendonca.com/tags/freenas">freenas</a></li><li><a href="https://blog.victormendonca.com/tags/kde">kde</a></li><li><a href="https://blog.victormendonca.com/tags/monitoring">monitoring</a></li><li><a href="https://blog.victormendonca.com/tags/shell">shell</a></li><li><a href="https://blog.victormendonca.com/tags/vim">vim</a></li><li><a href="https://blog.victormendonca.com/tags/arch">arch</a></li><li><a href="https://blog.victormendonca.com/tags/docker">docker</a></li><li><a href="https://blog.victormendonca.com/tags/macos">macos</a></li><li><a href="https://blog.victormendonca.com/tags/pfsense">pfsense</a></li><li><a href="https://blog.victormendonca.com/tags/systemd">systemd</a></li><li><a href="https://blog.victormendonca.com/tags/virtualbox">virtualbox</a></li><li><a href="https://blog.victormendonca.com/tags/ansible">ansible</a></li><li><a href="https://blog.victormendonca.com/tags/aws">aws</a></li><li><a href="https://blog.victormendonca.com/tags/encryption">encryption</a></li>
          </ul>
        </div>
      </div>
      
    
      
      
    

    <br />

    <div class="section">
      <header><div class="title"><b>Latest Posts</b></div></header>
      <div class="content">
        <ul>
        
          <li>
          <a href="https://blog.victormendonca.com/2021/02/28/getting-started-with-ansible-molecule/">Getting Started with Ansible Molecule</a>
          </li>
        
          <li>
          <a href="https://blog.victormendonca.com/2021/01/23/how-to-convert-standard-partition-to-lvm/">How to Convert Standard Partition to Logical Volume</a>
          </li>
        
          <li>
          <a href="https://blog.victormendonca.com/2020/11/18/linux-logical-volume-manager/">RHCSA v8: Linux Logical Volume Manager</a>
          </li>
        
          <li>
          <a href="https://blog.victormendonca.com/2020/11/14/rhcsa8-boot-targets-system-targets-and-root-password-reset/">RHCSA v8: Boot Targets, Systemd Targets and root Password Reset</a>
          </li>
        
          <li>
          <a href="https://blog.victormendonca.com/2020/11/03/zfs-for-dummies/">ZFS for Dummies</a>
          </li>
        
          <li>
          <a href="https://blog.victormendonca.com/2020/10/30/my-grafana-setup/">Overview of My Grafana Setup</a>
          </li>
        
          <li>
          <a href="https://blog.victormendonca.com/2020/10/29/how-to-collect-ups-data-on-pfsense-with-telegraf/">How to Collect UPS Data on pfSense with Telegraf</a>
          </li>
        
        </ul>
      </div>
    </div>

    <br />

    
    <div class="section">
    
      
      <div class="content" align="center" >
        <a class="twitter-timeline" data-width="240" data-height="450" href="https://twitter.com/victorbrca">Tweets by victorbrca</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
    </div>

</div>

        </div>
      
    </div>

  </div>

    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
  code with <i class='fa fa-linux'></i>

</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; 2018 Copyright Victor Mendonça

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="https://blog.victormendonca.com/js/jquery.min.js"></script>
<script src="https://blog.victormendonca.com/js/bootstrap.min.js"></script>


<script src="https://blog.victormendonca.com/js/highlight.pack.js"></script>
<script src="https://blog.victormendonca.com/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-113222099-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER =  false , 
EXPIRE_COOKIE =  5 , 
SHOW_MODAL_TIMEOUT =  10000 , 
MOUSE_LEAVE =  true , 
MODAL_SIZE = "", 
POST_URL = "https://zapier.com/hooks/catch/1227563/", 
SIGNUP_HEADER = "Join Our Newsletter",
HEADER_IMAGE = "//placehold.it/1000x600",
IMG_DESCRIPTION = "Placeholder image for this popover modal optin form",
SIGNUP_TEXT = "Signup today for free and be the first to get notified on new updates.",
INPUT_PLACEHOLDER = "Enter your email",
SUBMIT_BUTTON = "Subscribe",
SUCCESS_MESSAGE = "Thanks for your subscription!",
ERROR_MESSAGE = "Submitting form failed!",
OPTIN =  true ,
COOKIE_NAME = "mycookie1",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

